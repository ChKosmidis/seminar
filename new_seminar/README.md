# План рефакторинга «Семинар НКО» на TypeScript

Проект хранит много контента на русском языке, поэтому при любом автоматизированном шаге необходимо переключать PowerShell в кодировку UTF-8 (`chcp 65001`) или использовать инструменты, явно задающие `encoding='utf-8'`. Ниже — детальная дорожная карта переноса текущего статического сайта на стек TypeScript с сохранением существующего дизайна и интерактивов.

## 1. Цели
- Объединить все страницы в общую кодовую базу с переиспользуемыми компонентами.
- Переписать клиентскую логику (переключение тем, языков, интерактивы) на TypeScript.
- Настроить единый пайплайн сборки с поддержкой Unicode-контента и проверками качества.

## 2. Архитектурные решения
- **Фреймворк**: Vite + React (TypeScript). Лёгкий дев-сервер, быстрый HMR и готовая конфигурация под TS.
- **Структура**:
  - `src/components` — общие элементы (header, module strip, cards, интерактивные блоки).
  - `src/pages` — страничные контейнеры (Intro, Module1, … Module8, Resources).
  - `src/data` — текстовые ресурсы (RU/EN), иконки, схемы.
  - `src/hooks` — темы, локализация, общие интеракции.
  - `src/styles` — глобальные токены, переменные, CSS Modules / styled-components.
- **Межстраничная навигация**: React Router (статический экспорт) или Vite Static Copy для пререндеринга.
- **Локализация**: i18next или собственный словарь с типизированным набором ключей.
- **Темизация**: Context + CSS custom properties, синхронизация с `localStorage`.
- **Генерация PDF/интерактивы**: отдельные сервисы в `src/services` (TypeScript обёртки вокруг `jspdf`, `chart.js`).

## 3. Общие принципы реализации
1. **Кодировка**. Всегда сохранять файлы в UTF-8. В PowerShell — `chcp 65001`. В `package.json` добавить npm-script:
   ```json
   {
     "scripts": {
       "build": "node scripts/pre-build-utf8.js && vite build"
     }
   }
   ```
   где `pre-build-utf8.js` проверяет, что кодовая страница выставлена корректно или запускается через `cross-env`.
2. **Типы для контента**. Создать тип `LocalizedString` и словари `ru`, `en`, чтобы статически проверять наличие ключей.
3. **Иконки/SVG**. Хранить в `src/assets`. Для Lottie — использовать ts-описания.
4. **Стили**. Вынести переменные из `css/section.css` в токены, затем адаптировать под CSS Modules или Emotion.

## 4. Этапы миграции

### Этап 0. Подготовка
- [ ] Зафиксировать текущий репозиторий (ветка `main`).
- [ ] Создать ветку `feature/ts-refactor`.
- [ ] Сформировать список функций (тёмная тема, локализация, интерактивы каждого модуля).
- [ ] Скопировать исходные SVG, Lottie, JSON в отдельный каталог для импорта.
- [ ] Настроить ESLint + Prettier с поддержкой TypeScript, добавить Husky/pre-commit.

### Этап 1. Базовая оболочка
- [ ] Инициализировать Vite (`npm create vite@latest new-seminar -- --template react-ts`).
- [ ] Перенести глобальные стили и переменные (цвета, шрифты, spacing) в `src/styles/tokens.css`.
- [ ] Создать `Layout` (Header, мобильное меню, тема/язык, навигационная полоса) с моковыми данными.
- [ ] Настроить контексты `ThemeContext`, `LanguageContext`.
- [ ] Перенести логику `main.js` (инициализация, scroll-strip, анимации) в отдельные хук/utility (`useTheme`, `useLanguage`, `useModuleStrip`).

### Этап 2. Локализация и контент
- [ ] Создать типизированный словарь `src/data/i18n/moduleKeys.ts`.
- [ ] Экспортировать тексты для Intro, Module1 (включая длинные описания, списки) в JSON/TS-объекты.
- [ ] Подключить i18n-провайдер, убедиться, что переключение языка работает для всех компонент.
- [ ] Подготовить утилиты для кириллического текста (проверка `toLocaleLowerCase`, нормализация). Убедиться, что `vite.config.ts` выставляет `build.target` и `esbuild` использует UTF-8.

### Этап 3. Компоненты страниц
- [x] Создать универсальные компоненты: `Hero`, `ModuleCard`, `InteractiveCard`, `ModuleGrid`, `SectionsStrip`.
- [x] Перенести страницу `0_introduction` на TypeScript: использовать чистые компоненты + данные из словаря.
- [ ] Реализовать страницу `1_community_building`, сохранив склонение текста, интерактивы (переписать их на TS). В процессе убедиться, что кириллица отображается без искажений.
- [ ] Добавить `react-hook-form` или локальный стейт для форм, типизировать поля.
- [ ] На базе этой структуры построить остальные модули (2…8, resources). Пока достаточно статической разметки + анимации.

### Этап 4. Интерактивы и сервисы
- [ ] Переписать логику AI-подсказок, квизов, планов вовлечения на TypeScript в отдельных сервисах (`src/services/ai.ts`, `quiz.ts`).
- [ ] Обновить генерацию PDF (ts-обёртка вокруг `jspdf`).
- [ ] Переиспользовать анимации GSAP или заменить на `framer-motion` (при желании). Добавить типы для `ScrollTrigger`.
- [ ] Настроить ленивую загрузку тяжёлых библиотек.

### Этап 5. Сборка, тесты, деплой
- [ ] Настроить Vite `build` (статический экспорт в `dist`).
- [ ] Добавить `pnpm test` или `vitest` для проверки утилит.
- [ ] Прогнать Lighthouse по локальной сборке.
- [ ] Добавить GitHub Actions: `npm ci`, `npm run lint`, `npm run build`.
- [ ] Обновить README (основного репозитория) с инструкцией запуска TS-версии.

## 5. Особые замечания по UTF-8
- Всегда запускать PowerShell как `chcp 65001` перед генерацией файлов.
- В Node-скриптах использовать `fs.writeFileSync(path, data, 'utf8')`.
- Проверить, что `tsconfig.json` содержит `"charset": "utf8"` при необходимости.
- Сохранить исходный контент UTF-8 (интересны длинные тексты с кавычками, ёлочки, тире — протестировать их отображение).

## 6. Результат
- Все страницы построены на компонентах, переводы хранятся централизованно.
- Интерактивы и вспомогательные сервисы написаны на TypeScript.
- Пайплайн сборки гарантирует корректную работу с кириллицей и автоматические проверки качества.


## Статус выполнения
- [x] Этап 0 — подготовка окружения
- [x] Этап 1 — базовая оболочка
- [x] Этап 2 — локализация и контент
- [ ] Этап 3 — компоненты страниц
- [ ] Этап 4 — интерактивы и сервисы
- [ ] Этап 5 — сборка, тесты, деплой
