<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –†–∞–∑–≤–∏—Ç–∏–µ - –°–µ–º–∏–Ω–∞—Ä –ù–ö–û</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        body { padding-top: 70px; overflow-x: hidden; }
        .page-header-section {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); /* –ñ–µ–ª—Ç–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
            color: #212529; /* –¢–µ–º–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ —Å–≤–µ—Ç–ª–æ–º —Ñ–æ–Ω–µ */
            padding: 4rem 1.5rem; margin-bottom: 2rem; border-radius: .3rem; text-align: center;
        }
        .page-header-section img.header-icon { width: 80px; height: 80px; margin-bottom: 1rem; } /* –ë–µ–∑ –∏–Ω–≤–µ—Ä—Å–∏–∏ */

        .content-section { margin-bottom: 3rem; opacity: 0; transform: translateY(40px); }
        .content-section h3, .content-section h4 { 
            margin-bottom: 1.5rem; display: flex; align-items: center; 
            font-weight: 600; color: #343a40;
        }
        .content-section h3 img.section-icon, .content-section h4 img.section-icon { 
            width: 32px; height: 32px; margin-right: 0.8rem; opacity: 0.8;
        }

        /* KPI –†–∞–±–æ—á–∏–π –ª–∏—Å—Ç */
        .kpi-worksheet-intro { margin-bottom: 2rem; }
        .kpi-area-card {
            background-color: #fff; border-radius: .5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem; overflow: hidden;
        }
        .kpi-area-header {
            background-color: var(--bs-primary-bg-subtle); color: var(--bs-primary-text-emphasis);
            padding: 1rem 1.5rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        }
        .kpi-area-header h5 { margin-bottom: 0; font-size: 1.2rem; }
        .kpi-area-header .arrow-icon { transition: transform 0.3s ease; font-size: 1.5rem; }
        .kpi-area-card.active .kpi-area-header .arrow-icon { transform: rotate(180deg); }
        .kpi-area-content { padding: 1.5rem; display: block; height: 0; overflow: hidden; } /* Changed overflow to hidden */
        .kpi-table th { background-color: #f8f9fa; }

        /* PDCA –¶–∏–∫–ª */
        .pdca-cycle-container { display: flex; justify-content: space-around; align-items: flex-start; flex-wrap: wrap; margin-top: 2rem; }
        .pdca-step {
            flex-basis: calc(25% - 2rem); min-width: 200px; margin: 1rem; padding: 1.5rem;
            background-color: #fff; border-radius: .5rem; box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            text-align: center; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-top: 5px solid transparent; /* –î–ª—è —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ */
        }
        .pdca-step:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 6px 15px rgba(0,0,0,0.12); }
        .pdca-step img { width: 50px; height: 50px; margin-bottom: 1rem; }
        .pdca-step h5 { margin-bottom: 0.5rem; font-weight: 600; }
        .pdca-step p.details { font-size: 0.9rem; color: #555; display: none; margin-top: 0.75rem; text-align: left; }
        .pdca-step.active p.details { display: block; }
        /* –¶–≤–µ—Ç–∞ –¥–ª—è PDCA */
        .pdca-plan { border-top-color: var(--bs-info); }
        .pdca-do { border-top-color: var(--bs-success); }
        .pdca-check { border-top-color: var(--bs-warning); }
        .pdca-act { border-top-color: var(--bs-danger); }

        /* –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤ KPI –ú–æ–∑–≥–æ–≤–æ–π —à—Ç—É—Ä–º */
        #kpiBrainstormInteractive { background-color: #e9ecef; padding: 2rem; border-radius: .5rem; }
        .kpi-input-group { margin-bottom: 1.5rem; }
        #aiKpiFeedbackContainer { display: none; margin-top: 1.5rem; }
        #aiKpiFeedbackResult { white-space: pre-wrap; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –†–ê–ó–î–ï–õ–ê–ú */
        .section-nav-bar {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(255,255,255,0.97);
            box-shadow: 0 2px 8px rgba(6, 22, 13, 0.1); /* –∑–µ–ª–µ–Ω—ã–π –∞–∫—Ü–µ–Ω—Ç */
            padding: 0.5rem 0;
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
            transition: top 0.35s cubic-bezier(.4,1.6,.4,1), box-shadow 0.25s;
        }
        .section-nav-bar.section-nav-hidden {
            top: -70px;
            box-shadow: none;
        }
        .section-nav-btn {
            padding: 0.4rem 1rem;
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 0.5rem;
            transition: background-color 0.3s, transform 0.3s;
        }
        .section-nav-btn:hover {
            transform: translateY(-2px);
        }
        .section-nav-btn.btn-success {
            background-color: #fd7e14;
            color: white;
            border-color: #fd7e14
        }
        .section-nav-btn.btn-success:hover {
            background-color: #fd7e14;
            border-color: #fd7e14
        }
        .section-nav-btn.btn-outline-success {
            color: #fd7e14;
            border-color: #fd7e14;
        }
        .section-nav-btn.btn-outline-success:hover {
            background-color: #fd7e14;
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top shadow-sm">
            <div class="container">
                <a class="navbar-brand fw-bold d-flex align-items-center" href="../index.html">
                    <img src="../assets/images/logo.svg" alt="–õ–æ–≥–æ –ù–ö–û"> 
                    –ú–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –ù–ö–û: community building, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
                </a>
                <button class="navbar-custom-toggler ms-auto" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é" id="customMenuToggler" aria-expanded="false">
                    <svg viewBox="0 0 100 80" width="30" height="30" id="actualBurgerIcon" fill="currentColor">
                        <rect class="line line1" x="0" y="10" width="100" height="10" rx="5"></rect>
                        <rect class="line line2" x="0" y="35" width="100" height="10" rx="5"></rect>
                        <rect class="line line3" x="0" y="60" width="100" height="10" rx="5"></rect>
                    </svg>
                </button>
            </div>
        </nav>
    </header>

     <div class="fullscreen-menu" id="fullscreenMenu">
        <button class="close-menu-btn" id="closeFullscreenMenu" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é">√ó</button>
        <ul class="navbar-nav-fullscreen">
            <li class="nav-item fs-menu-item">
                <a class="nav-link" href="../index.html">–ì–ª–∞–≤–Ω–∞—è</a>
            </li>
            <li class="nav-item fs-menu-item custom-dropdown">
                <a class="nav-link dropdown-toggle-custom active" aria-current="page" href="#" id="sectionsDropdownCustomFs" role="button" aria-expanded="false">
                    –†–∞–∑–¥–µ–ª—ã
                </a>
                <ul class="dropdown-menu-custom">
                    <li><a class="dropdown-item" href="0_introduction.html">0. –í–≤–µ–¥–µ–Ω–∏–µ</a></li>
                    <li><a class="dropdown-item" href="1_community_building.html">1. –°–æ–æ–±—â–µ—Å—Ç–≤–æ</a></li>
                    <li><a class="dropdown-item" href="2_internal_communications.html">2. –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</a></li>
                    <li><a class="dropdown-item" href="3_infrastructure.html">3. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</a></li>
                    <li><a class="dropdown-item" href="4_legal_and_security.html">4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</a></li>
                    <li><a class="dropdown-item active" href="5_effectiveness_and_development.html">5. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</a></li>
                    <li><a class="dropdown-item" href="6_crisis_management.html">6. –ê–Ω—Ç–∏–∫—Ä–∏–∑–∏—Å</a></li>
                    <li><a class="dropdown-item" href="7_fundraising.html">7. –§–∞–Ω–¥—Ä–∞–π–∑–∏–Ω–≥</a></li>
                    <li><a class="dropdown-item" href="8_cases_and_practice.html">8. –ü—Ä–∞–∫—Ç–∏–∫–∞ –∏ –∫–µ–π—Å—ã</a></li>
                </ul>
            </li>
            <li class="nav-item fs-menu-item">
                <a class="nav-link" href="useful_resources.html">–ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã</a>
            </li>
        </ul>
    </div>

    <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –†–ê–ó–î–ï–õ–ê–ú -->
    <nav class="section-nav-bar" style="position:sticky;top:0;z-index:1000;background:rgba(255,255,255,0.97);box-shadow:0 2px 8px rgba(32,201,151,0.07);padding:0.5rem 0 0.5rem 0;display:flex;gap:0.5rem;justify-content:center;align-items:center;">
      <a href="0_introduction.html" class="btn btn-outline-success section-nav-btn">–í–≤–µ–¥–µ–Ω–∏–µ</a>
      <a href="1_community_building.html" class="btn btn-outline-success section-nav-btn">1. –°–æ–æ–±—â–µ—Å—Ç–≤–æ</a>
      <a href="2_internal_communications.html" class="btn btn-outline-success section-nav-btn">2. –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</a>
      <a href="3_infrastructure.html" class="btn btn-outline-success section-nav-btn">3. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</a>
      <a href="4_legal_and_security.html" class="btn btn-outline-success section-nav-btn">4. –ü—Ä–∞–≤–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</a>
      <a href="5_effectiveness_and_development.html" class="btn btn-success section-nav-btn">5. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</a>
      <a href="6_crisis_management.html" class="btn btn-outline-success section-nav-btn">6. –ö—Ä–∏–∑–∏—Å—ã</a>
      <a href="7_fundraising.html" class="btn btn-outline-success section-nav-btn">7. –§–∞–Ω–¥—Ä–∞–π–∑–∏–Ω–≥</a>
      <a href="8_cases_and_practice.html" class="btn btn-outline-success section-nav-btn">8. –ö–µ–π—Å—ã</a>
      <a href="useful_resources.html" class="btn btn-outline-secondary section-nav-btn">–†–µ—Å—É—Ä—Å—ã</a>
    </nav>
    <!-- /–ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –†–ê–ó–î–ï–õ–ê–ú -->

    <main>
        <div class="page-header-section">
            <img src="../assets/icons/efficiency.svg" alt="–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –†–∞–∑–≤–∏—Ç–∏–µ" class="header-icon">
            <h1 class="display-5 fw-bold">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –†–∞–∑–≤–∏—Ç–∏–µ</h1>
            <p class="lead">–ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –º—ã –¥–≤–∏–∂–µ–º—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏? –£—á–∏–º—Å—è —Å—Ç–∞–≤–∏—Ç—å —Ü–µ–ª–∏, –∏–∑–º–µ—Ä—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —É–ª—É—á—à–∞—Ç—å—Å—è.</p>
        </div>

        <div class="container py-4">
            <!-- 5.1-5.2. –†–∞–±–æ—á–∏–π –ª–∏—Å—Ç "KPI –¥–ª—è –ú–æ–µ–π –ù–ö–û" -->
            <section class="content-section" id="s5-1">
                <h3>
                    <img src="../assets/icons/cases.svg" alt="KPI" class="section-icon">
                    –¢—Ä–µ–Ω–∏—Ä—É–µ–º—Å—è –ø–æ–¥–±–∏—Ä–∞—Ç—å KPI –¥–ª—è –ù–ö–û
                </h3>
                <div class="kpi-worksheet-intro">
                    <p>–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (KPI) –ø–æ–º–æ–≥–∞—é—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–π. –≠—Ç–æ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ª–∏—Å—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å KPI –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π –≤–∞—à–µ–π –ù–ö–û. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –æ–±–ª–∞—Å—Ç—å, —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É.</p>
                </div>

                <div id="kpiAreasContainer">
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ KPI –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã JS -->
                </div>
            </section>

            <!-- 5.3. –°—Ö–µ–º–∞ "–¶–∏–∫–ª PDCA" -->
            <section class="content-section" id="s5-3">
                <h3>
                    <img src="../assets/icons/practical.svg" alt="PDCA" class="section-icon">
                    5.2. –¶–∏–∫–ª PDCA (Plan-Do-Check-Act) –¥–ª—è –ù–ö–û
                </h3>
                <p>–¶–∏–∫–ª PDCA (–ü–ª–∞–Ω–∏—Ä—É–π-–î–µ–ª–∞–π-–ü—Ä–æ–≤–µ—Ä—è–π-–î–µ–π—Å—Ç–≤—É–π), —Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ —Ü–∏–∫–ª –î–µ–º–∏–Ω–≥–∞-–®—É—Ö–∞—Ä—Ç–∞, ‚Äì —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ–π, –Ω–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ.</p>
                <div class="pdca-cycle-container">
                    <div class="pdca-step pdca-plan">
                        <img src="../assets/icons/introngo.svg" alt="–ü–ª–∞–Ω–∏—Ä—É–π">
                        <h5>Plan (–ü–ª–∞–Ω–∏—Ä—É–π)</h5>
                        <p class="details"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è. –ü–æ—Å—Ç–∞–≤—å—Ç–µ —á–µ—Ç–∫–∏–µ, –∏–∑–º–µ—Ä–∏–º—ã–µ —Ü–µ–ª–∏. –†–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —ç—Ç–∏—Ö —Ü–µ–ª–µ–π, –≤–∫–ª—é—á–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∏ —Å—Ä–æ–∫–∏.<br><strong>–ü—Ä–∏–º–µ—Ä –¥–ª—è –ù–ö–û:</strong> –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–≤ –Ω–∞ 20% –∑–∞ —Å–ª–µ–¥—É—é—â–∏–µ 3 –º–µ—Å—è—Ü–∞. –ü–ª–∞–Ω: –ø—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é –∫–∞–º–ø–∞–Ω–∏—é, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–µ–Ω—å –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥–≤–µ—Ä–µ–π.</p>
                    </div>
                    <div class="pdca-step pdca-do">
                         <img src="../assets/icons/low_budget.svg" alt="–î–µ–ª–∞–π">
                        <h5>Do (–î–µ–ª–∞–π)</h5>
                        <p class="details"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –ø–ª–∞–Ω. –í–∞–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ —Ö–æ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.<br><strong>–ü—Ä–∏–º–µ—Ä –¥–ª—è –ù–ö–û:</strong> –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ—Å—Ç—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö, —Ä–∞–∑–æ—Å–ª–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, –ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–µ–Ω—å –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥–≤–µ—Ä–µ–π, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã—Ö –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–≤.</p>
                    </div>
                    <div class="pdca-step pdca-check">
                         <img src="../assets/icons/efficiency.svg" alt="–ü—Ä–æ–≤–µ—Ä—è–π">
                        <h5>Check (–ü—Ä–æ–≤–µ—Ä—è–π)</h5>
                        <p class="details"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –°—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ü–µ–ª—è–º–∏. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ß—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ? –ß—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫? –ö–∞–∫–∏–µ –±—ã–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –ø–ª–∞–Ω–∞?<br><strong>–ü—Ä–∏–º–µ—Ä –¥–ª—è –ù–ö–û:</strong> –ß–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ –ø–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–≤. –°—Ä–∞–≤–Ω–∏—Ç—å —Å —Ü–µ–ª–µ–≤—ã–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–º. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ –∫–∞–Ω–∞–ª—ã –ø—Ä–∏–≤–ª–µ–∫–ª–∏ –±–æ–ª—å—à–µ –ª—é–¥–µ–π.</p>
                    </div>
                    <div class="pdca-step pdca-act">
                        <img src="../assets/icons/community.svg" alt="–î–µ–π—Å—Ç–≤—É–π">
                        <h5>Act (–î–µ–π—Å—Ç–≤—É–π/–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π)</h5>
                        <p class="details"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–∏–º–∏—Ç–µ –º–µ—Ä—ã. –ï—Å–ª–∏ —Ü–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä—É–π—Ç–µ —É—Å–ø–µ—à–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äì –≤—ã—è–≤–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—ã –∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ –ø–ª–∞–Ω –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞. –ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π —Ü–∏–∫–ª PDCA.<br><strong>–ü—Ä–∏–º–µ—Ä –¥–ª—è –ù–ö–û:</strong> –ï—Å–ª–∏ —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞, –∑–∞–∫—Ä–µ–ø–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äì –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∫–∞–º–ø–∞–Ω–∏–∏, –≤–æ–∑–º–æ–∂–Ω–æ, –∏–∑–º–µ–Ω–∏—Ç—å –∫–∞–Ω–∞–ª—ã –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π —Ü–∏–∫–ª.</p>
                    </div>
                </div>
            </section>

             <!-- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤: "–ú–æ–∑–≥–æ–≤–æ–π —à—Ç—É—Ä–º KPI" -->
            <section class="content-section" id="kpiBrainstormInteractiveSection">
                <h3>
                    <img src="../assets/icons/interactivity.svg" alt="–ú–æ–∑–≥–æ–≤–æ–π —à—Ç—É—Ä–º KPI" class="section-icon">
                    5.3. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤: –ú–æ–∑–≥–æ–≤–æ–π —à—Ç—É—Ä–º KPI
                </h3>
                <div id="kpiBrainstormInteractive" class="shadow-sm">
                    <p class="lead">–î–∞–≤–∞–π—Ç–µ –≤–º–µ—Å—Ç–µ –ø–æ–¥—É–º–∞–µ–º –Ω–∞–¥ KPI! –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –æ–±–ª–∞—Å—Ç–µ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ù–ö–û –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ 1-2 –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (KPI), –∫–æ—Ç–æ—Ä—ã–µ, –ø–æ –≤–∞—à–µ–º—É –º–Ω–µ–Ω–∏—é, –≤–∞–∂–Ω—ã –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É—Å–ø–µ—Ö–∞ –≤ —ç—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏. –¢–∞–∫–∂–µ –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ, –ø–æ—á–µ–º—É –≤—ã –≤—ã–±—Ä–∞–ª–∏ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç KPI.</p>
                    
                    <div class="kpi-input-group">
                        <label for="kpiAreaSelect" class="form-label fw-bold">–í—ã–±–µ—Ä–∏—Ç–µ –û–±–ª–∞—Å—Ç—å –ù–ö–û:</label>
                        <select class="form-select mb-2" id="kpiAreaSelect">
                            <option selected disabled value="">--- –í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å ---</option>
                            <option value="Community Building">Community Building (–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞)</option>
                            <option value="Internal Communications">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</option>
                            <option value="Infrastructure">–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</option>
                            <option value="Security">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Ü–∏—Ñ—Ä–æ–≤–∞—è, —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è)</option>
                            <option value="Advocacy">–ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è/–ê–¥–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
                        </select>
                        
                        <label for="kpiProposed" class="form-label fw-bold">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π KPI (1-2 –ø—Ä–∏–º–µ—Ä–∞):</label>
                        <input type="text" class="form-control mb-2" id="kpiProposed" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, '–£—Ä–æ–≤–µ–Ω—å –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö (ER)' –∏–ª–∏ '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ª–æ–Ω—Ç–µ—Ä—Å–∫–∏—Ö —á–∞—Å–æ–≤'">
                        
                        <label for="kpiRationale" class="form-label">–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ KPI (–ø–æ—á–µ–º—É –æ–Ω –≤–∞–∂–µ–Ω?):</label>
                        <textarea class="form-control" id="kpiRationale" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 'ER –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–Ω—Ç –∏–Ω—Ç–µ—Ä–µ—Å–µ–Ω –∞—É–¥–∏—Ç–æ—Ä–∏–∏'"></textarea>
                    </div>
                    <button type="button" class="btn btn-warning text-dark" id="getKpiAiAdviceBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ò–ò</button>

                    <div id="aiKpiFeedbackContainer" class="mt-4">
                        <h5 class="text-primary">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–∞ –ø–æ KPI:</h5>
                        <div id="aiKpiFeedbackResult" class="p-3 border rounded bg-light-subtle text-muted">
                            <em>–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ KPI –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É...</em>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="py-4 bg-dark text-white-50 mt-5">
         <div class="container text-center">
             <small>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Å–µ–º–∏–Ω–∞—Ä–∞ –®–∫–æ–ª—ã –ø—Ä–∞–≤ —á–µ–ª–æ–≤–µ–∫–∞ –∏–º. –ï–ª–µ–Ω—ã –ë–æ–Ω–Ω—ç—Ä ¬© 2025</small> <br>
             <small><em>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞ —Å–∞–π—Ç–µ –Ω–æ—Å–∏—Ç –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–µ–º–∏–Ω–∞—Ä–∞.</em></small>
             <div class="mt-4">
                 <button class="btn btn-success" id="exportSectionResultsBtn">–í—ã–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–¥–µ–ª–∞</button>
             </div>
         </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"></script>
    <script src="../assets/fonts/Qanelas-Regular.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
    <script>
    const GOOGLE_AI_API_KEY = "AIzaSyDl6bLHj4tFonVVBnKDhgIpdrTQuZXmhqo";
    const GOOGLE_AI_API_URL_BASE = "https://generativelanguage.googleapis.com/v1beta/models/";
    const GOOGLE_AI_MODEL = "gemma-3n-e4b-it"; 
    const GOOGLE_AI_API_URL = `${GOOGLE_AI_API_URL_BASE}${GOOGLE_AI_MODEL}:generateContent?key=${GOOGLE_AI_API_KEY}`;

    document.addEventListener('DOMContentLoaded', () => {
        gsap.registerPlugin(ScrollTrigger);

        // --- –ö–æ–¥ –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –º–µ–Ω—é ---
        const customMenuToggler = document.getElementById('customMenuToggler');
        const fullscreenMenu = document.getElementById('fullscreenMenu');
        const closeFullscreenMenuBtn = document.getElementById('closeFullscreenMenu');
        if (customMenuToggler && fullscreenMenu) { 
            const fsNav = fullscreenMenu.querySelector('.navbar-nav-fullscreen');
            const fsMenuItems = fsNav ? gsap.utils.toArray(fsNav.querySelectorAll('.fs-menu-item > a, .fs-menu-item > .dropdown-toggle-custom')) : [];
            const fsSubMenuItemsContainer = fsNav ? fsNav.querySelector('.fs-menu-item.custom-dropdown .dropdown-menu-custom') : null;
            const actualBurgerIcon = customMenuToggler.querySelector('svg');
            const burgerLine1 = actualBurgerIcon ? actualBurgerIcon.querySelector('.line1') : null;
            const burgerLine2 = actualBurgerIcon ? actualBurgerIcon.querySelector('.line2') : null;
            const burgerLine3 = actualBurgerIcon ? actualBurgerIcon.querySelector('.line3') : null;
            let burgerTimeline = gsap.timeline({ paused: true, reversed: true });
            if (burgerLine1 && burgerLine2 && burgerLine3) {
                const line1YInitial = parseFloat(burgerLine1.getAttribute('y'));
                const line2YInitial = parseFloat(burgerLine2.getAttribute('y'));
                const line3YInitial = parseFloat(burgerLine3.getAttribute('y'));
                if (!isNaN(line1YInitial) && !isNaN(line2YInitial) && !isNaN(line3YInitial)) {
                    burgerTimeline.to(burgerLine1,{duration:0.25,attr:{y:line2YInitial},ease:"power2.inOut"},"cross").to(burgerLine3,{duration:0.25,attr:{y:line2YInitial},ease:"power2.inOut"},"cross").to(burgerLine2,{duration:0.2,scaleX:0,transformOrigin:"50% 50%",ease:"power2.in"},"cross").to(burgerLine1,{duration:0.25,rotation:45,transformOrigin:"50% 50%",ease:"power2.out"},"crossEnd").to(burgerLine3,{duration:0.25,rotation:-45,transformOrigin:"50% 50%",ease:"power2.out"},"crossEnd");
                } else { burgerTimeline.to(actualBurgerIcon, {rotation: 180, duration: 0.3, ease:"power2.inOut"}); }
            } else if (actualBurgerIcon) { burgerTimeline.to(actualBurgerIcon, {rotation: 180, duration: 0.3, ease:"power2.inOut"}); }
            let fsMenuIsOpen = false;
            gsap.set(fullscreenMenu, { display: 'none', autoAlpha: 0 }); 
            if (fsMenuItems.length > 0) gsap.set(fsMenuItems, { autoAlpha: 0, y: 20 });
            if (fsSubMenuItemsContainer) gsap.set(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), {autoAlpha:0, y:10});
            const openFullscreenMenu = () => { if (fsMenuIsOpen) return; fsMenuIsOpen = true; fullscreenMenu.style.display = 'flex'; burgerTimeline.play(); customMenuToggler.classList.add('open'); customMenuToggler.setAttribute('aria-expanded', 'true'); const tlOpen = gsap.timeline(); tlOpen.to(fullscreenMenu, { autoAlpha: 1, duration: 0.35, ease: 'power1.out' }); if (fsMenuItems.length > 0) tlOpen.to(fsMenuItems, { autoAlpha: 1, y: 0, duration: 0.3, stagger: 0.06, ease: 'power1.out' }, "-=0.2"); const sectionsDropdownCustomFs = document.getElementById('sectionsDropdownCustomFs'); if (sectionsDropdownCustomFs && sectionsDropdownCustomFs.classList.contains('active') && fsSubMenuItemsContainer) { if (sectionsDropdownCustomFs.getAttribute('aria-expanded') === 'true' || fsSubMenuItemsContainer.style.height === 'auto') { tlOpen.to(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), { autoAlpha:1, y:0, duration: 0.2, stagger: 0.04, ease: 'power1.out' }, "-=0.1"); }}};
            const closeFullscreenMenu = () => { if (!fsMenuIsOpen) return; fsMenuIsOpen = false; burgerTimeline.reverse(); customMenuToggler.classList.remove('open'); customMenuToggler.setAttribute('aria-expanded', 'false'); const tlClose = gsap.timeline({onComplete: () => { fullscreenMenu.style.display = 'none'; if (fsSubMenuItemsContainer && (fsSubMenuItemsContainer.style.height !== '0px' && fsSubMenuItemsContainer.style.height !== '' && fsSubMenuItemsContainer.style.height !== null)) { gsap.set(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), {autoAlpha:0, y:10}); gsap.set(fsSubMenuItemsContainer, { height: 0, autoAlpha: 0, marginTop: 0, marginBottom: 0}); const sectionsDropdownCustomFs = document.getElementById('sectionsDropdownCustomFs'); if(sectionsDropdownCustomFs) sectionsDropdownCustomFs.setAttribute('aria-expanded', 'false');}}}); if (fsSubMenuItemsContainer && (fsSubMenuItemsContainer.style.height !== '0px' && fsSubMenuItemsContainer.style.height !== '' && fsSubMenuItemsContainer.style.height !== null)) { tlClose.to(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), { autoAlpha:0, y:10, duration:0.15, stagger: {each:0.03, from:"end"}, ease:'power1.in' });} if (fsMenuItems.length > 0) tlClose.to(fsMenuItems, { autoAlpha: 0, y: 15, duration: 0.2, stagger: { each: 0.04, from: "end" }, ease: 'power1.in' }, fsSubMenuItemsContainer ? "-=0.1" : 0); tlClose.to(fullscreenMenu, { autoAlpha: 0, duration: 0.25, ease: 'power1.in' }, fsMenuItems.length > 0 ? "-=0.1" : 0); };
            customMenuToggler.addEventListener('click', () => { fsMenuIsOpen ? closeFullscreenMenu() : openFullscreenMenu(); });
            if (closeFullscreenMenuBtn) closeFullscreenMenuBtn.addEventListener('click', closeFullscreenMenu);
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && fsMenuIsOpen) closeFullscreenMenu(); });
            const sectionsDropdownCustomFs = document.getElementById('sectionsDropdownCustomFs');
            if (sectionsDropdownCustomFs && fsSubMenuItemsContainer) {
                gsap.set(fsSubMenuItemsContainer, { height: 0, autoAlpha: 0, marginTop:0, marginBottom:0 }); gsap.set(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), {autoAlpha:0, y:10});
                let subMenuFsIsOpen = false;
                sectionsDropdownCustomFs.addEventListener('click', (e) => {
                    e.preventDefault(); subMenuFsIsOpen = !subMenuFsIsOpen; sectionsDropdownCustomFs.setAttribute('aria-expanded', subMenuFsIsOpen.toString());
                    if (subMenuFsIsOpen) { gsap.timeline().to(fsSubMenuItemsContainer, { height: 'auto', autoAlpha: 1, marginTop: '0.5rem', marginBottom: '0.5rem', duration: 0.3, ease: 'power1.out' }).to(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), { autoAlpha:1, y:0, duration:0.25, stagger:0.05, ease:'power1.out' }, "-=0.2");
                    } else { gsap.timeline().to(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), { autoAlpha:0, y:10, duration:0.2, stagger:{each:0.04, from:"end"}, ease:'power1.in' }).to(fsSubMenuItemsContainer, { height: 0, autoAlpha: 0, marginTop: 0, marginBottom: 0, duration: 0.3, ease: 'power1.in' }, "-=0.1");}
                });
                const fsSubMenuLinks = fsSubMenuItemsContainer ? gsap.utils.toArray(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item')) : [];
                fsSubMenuLinks.forEach(link => { link.addEventListener('mouseenter', () => gsap.to(link, { color: '#0d6efd', x: 3, duration: 0.2 })); link.addEventListener('mouseleave', () => gsap.to(link, { color: (link.classList.contains('active') ? '#0d6efd' : '#495057'), x: 0, duration: 0.2 }));});
            }
            const activeFsDropdownItem = fullscreenMenu.querySelector('.dropdown-menu-custom a.dropdown-item.active');
            if (activeFsDropdownItem) { activeFsDropdownItem.style.color = '#0d6efd'; activeFsDropdownItem.style.fontWeight = '500';}
        }


        // --- –û–ë–©–ò–ï –ê–ù–ò–ú–ê–¶–ò–ò –°–¢–†–ê–ù–ò–¶–´ ---
        gsap.from(".page-header-section h1", {duration: 0.8, y: -50, opacity: 0, ease: "power2.out", delay: 0.2});
        gsap.from(".page-header-section p.lead", {duration: 0.8, y: -30, opacity: 0, ease: "power2.out", delay: 0.4});
        gsap.from(".page-header-section .header-icon", {duration: 1, scale: 0.5, opacity: 0, ease: "back.out(1.7)", delay: 0.1});

        const contentSections = gsap.utils.toArray('.content-section');
        contentSections.forEach(section => {
            gsap.to(section, { 
                opacity: 1, y: 0, duration: 0.7, ease: "power1.out",
                scrollTrigger: { trigger: section, start: "top 85%", once: true }
            });
        });

        // --- –†–∞–±–æ—á–∏–π –ª–∏—Å—Ç KPI ---
        const kpiAreasData = [
            { title: "–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –°–æ–æ–±—â–µ—Å—Ç–≤–∞ (Community Building)", icon: "community.svg", examples: [
                { goal: "–£–≤–µ–ª–∏—á–∏—Ç—å –æ–Ω–ª–∞–π–Ω-–∞—É–¥–∏—Ç–æ—Ä–∏—é", kpi: "–ü—Ä–∏—Ä–æ—Å—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö; –û—Ö–≤–∞—Ç –ø–æ—Å—Ç–æ–≤", measure: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ü—Å–µ—Ç–µ–π" },
                { goal: "–ü–æ–≤—ã—Å–∏—Ç—å –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å", kpi: "–£—Ä–æ–≤–µ–Ω—å –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ (ER); –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤/—Ä–µ–ø–æ—Å—Ç–æ–≤", measure: "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ—Å—Ç–æ–≤; –†—É—á–Ω–æ–π –ø–æ–¥—Å—á–µ—Ç" },
                { goal: "–ü—Ä–∏–≤–ª–µ—á—å –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–≤", kpi: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–≤; –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ª–æ–Ω—Ç–µ—Ä—Å–∫–∏—Ö —á–∞—Å–æ–≤", measure: "–ê–Ω–∫–µ—Ç—ã –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–≤; –£—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏" }
            ]},
            { title: "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", icon: "communication.svg", examples: [
                { goal: "–£–ª—É—á—à–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã", kpi: "–£—Ä–æ–≤–µ–Ω—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–µ–π (–æ–ø—Ä–æ—Å); –°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏", measure: "–ê–Ω–æ–Ω–∏–º–Ω—ã–µ –æ–ø—Ä–æ—Å—ã; –ó–∞–º–µ—Ä—ã –≤—Ä–µ–º–µ–Ω–∏" },
                { goal: "–ü–æ–≤—ã—Å–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—á", kpi: "–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –ø–æ –∏—Ç–æ–≥–∞–º –≤—Å—Ç—Ä–µ—á; –û—Ü–µ–Ω–∫–∞ –≤—Å—Ç—Ä–µ—á —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏", measure: "–ü—Ä–æ—Ç–æ–∫–æ–ª—ã; –û–ø—Ä–æ—Å–Ω–∏–∫–∏" }
            ]},
            { title: "–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞", icon: "Infrastructure.svg", examples: [
                { goal: "–û–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ—Å–ø–µ—Ä–µ–±–æ–π–Ω—É—é —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞", kpi: "–í—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞ (uptime); –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü", measure: "–°–µ—Ä–≤–∏—Å—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (UptimeRobot); Google PageSpeed" },
                { goal: "–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CRM", kpi: "–ü–æ–ª–Ω–æ—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ CRM; –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö CRM", measure: "–í—ã–±–æ—Ä–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞; –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ CRM" }
            ]},
             { title: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å", icon: "safety.svg", examples: [
                { goal: "–ü–æ–≤—ã—Å–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Ü–∏—Ñ—Ä–æ–≤–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã", kpi: "–ü—Ä–æ—Ü–µ–Ω—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –ø—Ä–æ—à–µ–¥—à–∏—Ö —Ç—Ä–µ–Ω–∏–Ω–≥ –ø–æ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏; –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ (—Ñ–∏—à–∏–Ω–≥)", measure: "–£—á–µ—Ç —Ç—Ä–µ–Ω–∏–Ω–≥–æ–≤; –ñ—É—Ä–Ω–∞–ª –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤" },
                { goal: "–û–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö", kpi: "–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º; –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –±—ç–∫–∞–ø–æ–≤", measure: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏—Ç; –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –±—ç–∫–∞–ø–æ–≤" }
            ]},
             { title: "–ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è/–ê–¥–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω–∞—è –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å", icon: "rights.svg", examples: [
                { goal: "–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∫–∞–∑–∞–Ω–Ω–æ–π –ø–æ–º–æ—â–∏", kpi: "–ß–∏—Å–ª–æ —É—Å–ø–µ—à–Ω—ã—Ö –∫–µ–π—Å–æ–≤/–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π; –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–Ω–µ—Ñ–∏—Ü–∏–∞—Ä–æ–≤", measure: "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞; –û—Ç—á–µ—Ç—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º" },
                { goal: "–ü–æ–≤—ã—Å–∏—Ç—å –æ—Å–≤–µ–¥–æ–º–ª–µ–Ω–Ω–æ—Å—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ", kpi: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–π –≤ –°–ú–ò –æ –ø—Ä–æ–±–ª–µ–º–µ/–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ù–ö–û; –û—Ö–≤–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π", measure: "–ú–µ–¥–∏–∞–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥; –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ü—Å–µ—Ç–µ–π/—Å–∞–π—Ç–∞" }
            ]}
        ];

        const kpiContainer = document.getElementById('kpiAreasContainer');
        kpiAreasData.forEach((area, areaIdx) => {
            const card = document.createElement('div');
            card.className = 'kpi-area-card';
            let examplesHtml = '<div class="table-responsive"><table class="table kpi-table table-sm table-hover"><thead><tr><th>–ö–ª—é—á–µ–≤–∞—è —Ü–µ–ª—å</th><th>–í–æ–∑–º–æ–∂–Ω—ã–µ KPI (–ø—Ä–∏–º–µ—Ä—ã)</th><th>–ö–∞–∫ –∏–∑–º–µ—Ä–∏—Ç—å?</th></tr></thead><tbody>';
            area.examples.forEach((ex, exIdx) => {
                examplesHtml += `<tr data-row="${exIdx}">
                    <td class="kpi-quiz-cell kpi-goal" data-col="goal" data-row="${exIdx}">${ex.goal}</td>
                    <td class="kpi-quiz-cell kpi-kpi" data-col="kpi" data-row="${exIdx}">${ex.kpi}</td>
                    <td class="kpi-quiz-cell kpi-measure" data-col="measure" data-row="${exIdx}">${ex.measure}</td>
                </tr>`;
            });
            examplesHtml += '</tbody></table></div>';
            card.innerHTML = `
                <div class="kpi-area-header">
                    <h5><img src="../assets/icons/${area.icon}" alt="${area.title}" style="width:28px; height:28px;" class="me-2">${area.title}</h5> 
                    <span class="arrow-icon">‚ñº</span>
                </div>
                <div class="kpi-area-content">
                    ${examplesHtml}
                    <div class="mt-3">
                        <button type="button" class="btn btn-success" style="display:none;" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ò–ò –¥–ª—è –æ—Ü–µ–Ω–∫–∏</button>
                        <div class="kpi-ai-feedback mt-3" style="display:none;">
                            <h6 class="text-primary">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–∞ –ø–æ KPI:</h6>
                            <div class="kpi-ai-feedback-result p-2 border rounded bg-light-subtle text-muted"><em>–°–¥–µ–ª–∞–π—Ç–µ –≤—ã–±–æ—Ä –ø–æ –∫–∞–∂–¥–æ–º—É —Å—Ç–æ–ª–±—Ü—É –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ –æ—Ü–µ–Ω–∫—É...</em></div>
                        </div>
                    </div>
                </div>`;
            kpiContainer.appendChild(card);
            const header = card.querySelector('.kpi-area-header');
            const content = card.querySelector('.kpi-area-content');
            gsap.set(content, { height: 0, autoAlpha: 0 });
            header.addEventListener('click', () => {
                const isActive = card.classList.toggle('active');
                if (isActive) {
                    gsap.set(content, {height: 'auto', autoAlpha: 1}); // Set to auto first
                    gsap.from(content, {height: 0, autoAlpha: 0, duration: 0.4, ease: 'power2.inOut', onComplete: () => {
                        content.style.height = 'auto'; // Ensure it remains auto after animation
                         ScrollTrigger.refresh(); // Refresh ScrollTrigger if content height changes
                    }});
                } else {
                    gsap.to(content, {height: 0, autoAlpha: 0, duration: 0.4, ease: 'power2.inOut', onComplete: () => {
                         ScrollTrigger.refresh();
                    }});
                }
            });
            const quizCells = card.querySelectorAll('.kpi-quiz-cell');
            const sendBtn = card.querySelector('button.btn-success');
            const feedbackBlock = card.querySelector('.kpi-ai-feedback');
            const feedbackResult = card.querySelector('.kpi-ai-feedback-result');
            let selected = { goal: null, kpi: null, measure: null };
            quizCells.forEach(cell => {
                cell.style.cursor = 'pointer';
                cell.addEventListener('click', () => {
                    const col = cell.getAttribute('data-col');
                    card.querySelectorAll(`.kpi-quiz-cell.kpi-${col}`).forEach(c => c.classList.remove('table-success'));
                    cell.classList.add('table-success');
                    selected[col] = cell.innerText;
                    if (selected.goal && selected.kpi && selected.measure) {
                        sendBtn.style.display = 'inline-block'; sendBtn.disabled = false;
                    } else { sendBtn.style.display = 'none'; sendBtn.disabled = true; }
                    feedbackBlock.style.display = 'none';
                });
            });
            sendBtn.addEventListener('click', async () => {
                if (!selected.goal || !selected.kpi || !selected.measure) return;
                sendBtn.disabled = true; sendBtn.innerText = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
                feedbackBlock.style.display = 'block'; feedbackResult.innerHTML = '<em>üìä –ò–ò –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –≤–∞—à –≤—ã–±–æ—Ä...</em>';
                try {
                    const userSelectionPrompt = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª:\n–¶–µ–ª—å: ${selected.goal}\nKPI: ${selected.kpi}\n–ú–µ—Ç—Ä–∏–∫–∞: ${selected.measure}`;
                    const systemPromptForKpiWorksheet = "–¢—ã ‚Äî –ò–ò-–º–µ–Ω—Ç–æ—Ä –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é –ù–ö–û. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –¥–∞—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–¥–±—ç–∫ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ KPI, –æ—Ü–µ–Ω–∏–≤ –∏—Ö –ø–æ SMART-–∫—Ä–∏—Ç–µ—Ä–∏—è–º. –ë—É–¥—å –∫—Ä–∞—Ç–æ–∫, –¥—Ä—É–∂–µ–ª—é–±–µ–Ω –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–π —É–ª—É—á—à–µ–Ω–∏—è. –û—Ç–≤–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º.";
                    const combinedPrompt = `${systemPromptForKpiWorksheet}\n\n### –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n${userSelectionPrompt}\n\n### –¢–≤–æ–π —Ñ–∏–¥–±—ç–∫:`;

                    const requestPayload = {
                        contents: [{ role: "user", parts: [{ "text": combinedPrompt }] }],
                        generationConfig: { temperature: 0.5, maxOutputTokens: 400 }
                    };
                    const response = await fetch(GOOGLE_AI_API_URL, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(requestPayload)
                    });
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({ error: { message: 'Unknown API error format' } }));
                        console.error("Google AI API Error (KPI Worksheet):", errorData);
                        throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${response.status} - ${errorData.error?.message || response.statusText}`);
                    }
                    const data = await response.json();
                    let aiMessage = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –ò–ò.";
                    aiMessage = aiMessage.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>').replace(/^\s*-\s*(.*)/gm, '<li>$1</li>');
                    if (aiMessage.includes('<li>')) { aiMessage = aiMessage.replace(/(<li>.*?<\/li>\s*)+/g, (match) => `<ul>${match}</ul>`); aiMessage = aiMessage.replace(/<\/ul>\s*<ul>/g, '');}
                    aiMessage = aiMessage.replace(/\n/g, '<br>');
                    feedbackResult.innerHTML = aiMessage;
                } catch (error) {
                    console.error('AI KPI Worksheet Error:', error);
                    feedbackResult.innerHTML = `üò• –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–≤–µ—Ç–∞ –æ—Ç –ò–ò. <small>${error.message}</small>`;
                } finally { sendBtn.disabled = false; sendBtn.innerText = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ò–ò –¥–ª—è –æ—Ü–µ–Ω–∫–∏'; }
            });
        });
        
        // --- PDCA –¶–∏–∫–ª –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤ ---
        const pdcaSteps = document.querySelectorAll('.pdca-step');
        pdcaSteps.forEach(step => {
            const details = step.querySelector('p.details');
            gsap.set(details, {height: 0, autoAlpha: 0, marginTop:0});
            step.addEventListener('click', () => {
                const isActive = step.classList.toggle('active');
                if (isActive) {
                    gsap.set(details, {height: 'auto', autoAlpha: 1, marginTop: '0.75rem'});
                    gsap.from(details, {height: 0, autoAlpha: 0, marginTop:0, duration: 0.3, ease: 'power1.inOut'});
                } else {
                    gsap.to(details, {height: 0, autoAlpha: 0, marginTop:0, duration: 0.3, ease: 'power1.inOut'});
                }
            });
        });

        // --- –ú–æ–∑–≥–æ–≤–æ–π —à—Ç—É—Ä–º KPI —Å –ò–ò ---
        const getKpiAiAdviceBtn = document.getElementById('getKpiAiAdviceBtn');
        const aiKpiFeedbackContainer = document.getElementById('aiKpiFeedbackContainer');
        const aiKpiFeedbackResultEl = document.getElementById('aiKpiFeedbackResult');

        if(getKpiAiAdviceBtn && aiKpiFeedbackContainer && aiKpiFeedbackResultEl) {
            gsap.set(aiKpiFeedbackContainer, {display: 'none', autoAlpha:0});
            getKpiAiAdviceBtn.addEventListener('click', async () => {
                const area = document.getElementById('kpiAreaSelect').value;
                const kpi = document.getElementById('kpiProposed').value;
                const rationale = document.getElementById('kpiRationale').value;
                if (!area || !kpi || !rationale) { alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ KPI –∏ –µ–≥–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ."); return; }
                gsap.timeline().set(aiKpiFeedbackContainer, {display: 'block'}).to(aiKpiFeedbackContainer, {autoAlpha:1, y:0, duration:0.4, ease: 'power2.out'});
                aiKpiFeedbackResultEl.innerHTML = '<em>üìä –ò–ò –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –≤–∞—à–∏ KPI...</em>';
                gsap.fromTo(aiKpiFeedbackResultEl, {opacity:0.5, y:5}, {opacity:1, y:0, duration:0.3});
                try {
                    const userPromptForBrainstorm = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ö–û –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç KPI –¥–ª—è –æ–±–ª–∞—Å—Ç–∏ "${area}":\n–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π KPI: ${kpi}\n–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: ${rationale}`;
                    const systemPromptForKpiBrainstorm = "–¢—ã ‚Äî –ò–ò-–º–µ–Ω—Ç–æ—Ä –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é –ù–ö–û. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –¥–∞—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–π –∏ –∫—Ä–∞—Ç–∫–∏–π —Ñ–∏–¥–±—ç–∫ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ KPI, –æ—Ü–µ–Ω–∏–≤ –∏—Ö –ø–æ SMART-–∫—Ä–∏—Ç–µ—Ä–∏—è–º (–≥–¥–µ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ). –ö—Ä–∞—Ç–∫–æ. –û—Ç–≤–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º.";
                    const combinedPrompt = `${systemPromptForKpiBrainstorm}\n\n### –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n${userPromptForBrainstorm}\n\n### –¢–≤–æ–π —Ñ–∏–¥–±—ç–∫:`;
                    
                    const requestPayload = {
                        contents: [{ role: "user", parts: [{ "text": combinedPrompt }] }],
                        generationConfig: { temperature: 0.5, maxOutputTokens: 400 }
                    };
                    const response = await fetch(GOOGLE_AI_API_URL, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(requestPayload)
                    });
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({ error: { message: 'Unknown API error format' } }));
                        console.error("Google AI API Error (KPI Brainstorm):", errorData);
                        throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${response.status} - ${errorData.error?.message || response.statusText}`);
                    }
                    const data = await response.json();
                    let aiMessage = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –ò–ò.";
                    aiMessage = aiMessage.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>').replace(/^\s*-\s*(.*)/gm, '<li>$1</li>');
                    if (aiMessage.includes('<li>')) { aiMessage = aiMessage.replace(/(<li>.*?<\/li>\s*)+/g, (match) => `<ul>${match}</ul>`); aiMessage = aiMessage.replace(/<\/ul>\s*<ul>/g, '');}
                    aiMessage = aiMessage.replace(/\n/g, '<br>');
                    gsap.to(aiKpiFeedbackResultEl, {opacity:0, y:-5, duration:0.2, onComplete: () => {
                        aiKpiFeedbackResultEl.innerHTML = aiMessage;
                        gsap.to(aiKpiFeedbackResultEl, {opacity:1, y:0, duration:0.4, ease: 'power2.out'});
                    }});
                } catch (error) { 
                     console.error('AI KPI Brainstorm Error:', error);
                    gsap.to(aiKpiFeedbackResultEl, {opacity:0, y:-5, duration:0.2, onComplete: () => {
                        aiKpiFeedbackResultEl.innerHTML = `üò• –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–≤–µ—Ç–∞ –æ—Ç –ò–ò. <small>${error.message}</small>`;
                        gsap.to(aiKpiFeedbackResultEl, {opacity:1, y:0, duration:0.4, ease: 'power2.out'});
                    }});
                }
            });
        }
        
        // --- PDF —ç–∫—Å–ø–æ—Ä—Ç —Ä–∞–∑–¥–µ–ª–∞ 5 ---
        const exportBtn = document.getElementById('exportSectionResultsBtn');
        if (exportBtn) {
            exportBtn.addEventListener('click', function() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({unit: 'pt', format: 'a4'});
                if (window.QanelasRegularFontData && window.QanelasRegularFontData.base64) {
                    doc.addFileToVFS('Qanelas-Regular.ttf', window.QanelasRegularFontData.base64);
                    doc.addFont('Qanelas-Regular.ttf', 'Qanelas', 'normal');
                }
                doc.setFont('Qanelas', 'normal');
                const pageWidth = doc.internal.pageSize.getWidth();
                let y = 40;
                doc.setFontSize(22); doc.setTextColor('#fd7e14'); doc.text('–†–∞–∑–¥–µ–ª 5: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ', pageWidth/2, y, {align:'center'}); y += 30;
                
                // KPI –†–∞–±–æ—á–∏–π –ª–∏—Å—Ç
                doc.setFontSize(15); doc.setTextColor('#fd7e14'); y += 5;
                doc.text("5.1. –†–∞–±–æ—á–∏–π –ª–∏—Å—Ç: \"KPI –¥–ª—è –ú–æ–µ–π –ù–ö–û\"", 40, y); y += 20;
                doc.setFontSize(10); doc.setTextColor('#444');
                const kpiCards = document.querySelectorAll('#kpiAreasContainer .kpi-area-card');
                kpiCards.forEach(card => {
                    const areaTitle = card.querySelector('.kpi-area-header h5')?.innerText.trim() || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
                    const selectedCells = card.querySelectorAll('.kpi-quiz-cell.table-success');
                    if(selectedCells.length === 3){ // Only if a full row is selected
                        doc.setFontSize(12); doc.setTextColor('#333'); y+=5;
                        doc.text(`–û–±–ª–∞—Å—Ç—å: ${areaTitle}`, 40, y); y+=15;
                        doc.setFontSize(10);
                        const goalText = card.querySelector('.kpi-goal.table-success')?.innerText || "-";
                        const kpiText = card.querySelector('.kpi-kpi.table-success')?.innerText || "-";
                        const measureText = card.querySelector('.kpi-measure.table-success')?.innerText || "-";
                        const tableData = [
                            ["–¶–µ–ª—å", goalText],
                            ["KPI", kpiText],
                            ["–ò–∑–º–µ—Ä–µ–Ω–∏–µ", measureText]
                        ];
                        doc.autoTable({
                            startY: y,
                            head: [['–ü–∞—Ä–∞–º–µ—Ç—Ä', '–í—ã–±—Ä–∞–Ω–æ']],
                            body: tableData,
                            theme: 'grid', headStyles: {fillColor: [255, 193, 7]}, styles: {font: 'Qanelas', fontSize:9, cellPadding:3},
                            margin: {left: 40, right: 40}
                        });
                        y = doc.lastAutoTable.finalY + 10;

                        const aiFeedbackResultKPI = card.querySelector('.kpi-ai-feedback-result')?.innerText;
                        if (aiFeedbackResultKPI && aiFeedbackResultKPI.trim() && !aiFeedbackResultKPI.includes('–ò–ò –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –≤–∞—à –≤—ã–±–æ—Ä...')) {
                            doc.setFontSize(10); doc.setTextColor('#0d6efd'); y += 5;
                            doc.text('AI-–æ—Ç–∑—ã–≤ –ø–æ –≤—ã–±–æ—Ä—É KPI:', 45, y); y += 12;
                            doc.setFontSize(9); doc.setTextColor('#555');
                            const splitFeedback = doc.splitTextToSize(aiFeedbackResultKPI, pageWidth - 90);
                            doc.text(splitFeedback, 45, y); y += splitFeedback.length * 11 + 8;
                        }
                        if (y > doc.internal.pageSize.getHeight() - 60) { doc.addPage(); y = 40; }
                    }
                });
                y += 10;
                if (y > doc.internal.pageSize.getHeight() - 60) { doc.addPage(); y = 40; }


                // PDCA
                doc.setFontSize(15); doc.setTextColor('#fd7e14'); y+=5;
                doc.text("5.2. –¶–∏–∫–ª PDCA (Plan-Do-Check-Act) –¥–ª—è –ù–ö–û", 40, y); y += 20;
                doc.setFontSize(10); doc.setTextColor('#444');
                const pdcaElements = document.querySelectorAll('#s5-3 .pdca-step');
                pdcaElements.forEach(el => {
                    const stepTitle = el.querySelector('h5')?.innerText.trim();
                    const stepDetails = el.querySelector('p.details')?.innerText.trim().replace(/–û–ø–∏—Å–∞–Ω–∏–µ:\s*/, '').replace(/–ü—Ä–∏–º–µ—Ä –¥–ª—è –ù–ö–û:\s*/, '\n–ü—Ä–∏–º–µ—Ä: ');
                    if(stepTitle && stepDetails){
                        doc.setFontSize(11); doc.setTextColor('#333');
                        doc.text(`‚Ä¢ ${stepTitle}`, 45, y); y+=13;
                        doc.setFontSize(9); doc.setTextColor('#555');
                        const splitDetails = doc.splitTextToSize(stepDetails, pageWidth - 90);
                        doc.text(splitDetails, 50, y); y += splitDetails.length * 11 + 5;
                        if (y > doc.internal.pageSize.getHeight() - 60) { doc.addPage(); y = 40; }
                    }
                });
                y += 10;
                 if (y > doc.internal.pageSize.getHeight() - 60) { doc.addPage(); y = 40; }


                // KPI Brainstorm
                const kpiAreaSelected = document.getElementById('kpiAreaSelect').value;
                const kpiProposedText = document.getElementById('kpiProposed').value;
                const kpiRationaleText = document.getElementById('kpiRationale').value;
                const aiKpiFeedbackBrainstorm = document.getElementById('aiKpiFeedbackResult')?.innerText;

                if (kpiAreaSelected || kpiProposedText || kpiRationaleText) {
                     doc.setFontSize(15); doc.setTextColor('#fd7e14'); y += 5;
                     doc.text("5.3. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤: –ú–æ–∑–≥–æ–≤–æ–π —à—Ç—É—Ä–º KPI", 40, y); y += 20;
                     doc.setFontSize(10); doc.setTextColor('#444');
                    const brainstormData = [
                        ["–í—ã–±—Ä–∞–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å:", kpiAreaSelected || "–ù–µ —É–∫–∞–∑–∞–Ω–æ"],
                        ["–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π KPI:", kpiProposedText || "–ù–µ —É–∫–∞–∑–∞–Ω–æ"],
                        ["–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:", kpiRationaleText || "–ù–µ —É–∫–∞–∑–∞–Ω–æ"]
                    ];
                     doc.autoTable({
                        startY: y,
                        head: [['–ü–∞—Ä–∞–º–µ—Ç—Ä', '–í–∞—à –≤–≤–æ–¥']],
                        body: brainstormData,
                        theme: 'grid', headStyles: {fillColor: [255, 193, 7]}, styles: {font: 'Qanelas', fontSize:9, cellPadding:3},
                        margin: {left: 40, right: 40}
                    });
                    y = doc.lastAutoTable.finalY + 10;
                    if (y > doc.internal.pageSize.getHeight() - 60) { doc.addPage(); y = 40; }

                    if (aiKpiFeedbackBrainstorm && aiKpiFeedbackBrainstorm.trim() && !aiKpiFeedbackBrainstorm.includes('–ò–ò –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –≤–∞—à–∏ KPI...')) {
                        doc.setFontSize(10); doc.setTextColor('#0d6efd'); y += 5;
                        doc.text('AI-–æ—Ç–∑—ã–≤ –ø–æ –º–æ–∑–≥–æ–≤–æ–º—É —à—Ç—É—Ä–º—É KPI:', 45, y); y += 12;
                        doc.setFontSize(9); doc.setTextColor('#555');
                        const split = doc.splitTextToSize(aiKpiFeedbackBrainstorm, pageWidth - 90);
                        doc.text(split, 45, y); y += split.length * 11 + 8;
                        if (y > doc.internal.pageSize.getHeight() - 60) { doc.addPage(); y = 40; }
                    }
                }
                doc.save('effectiveness_and_development_results.pdf');
            });
        }

        ScrollTrigger.refresh();
    });
    </script>
</body>
</html>