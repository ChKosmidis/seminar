<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2. Внутренние Коммуникации - Семинар НКО</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style.css">
    
    <style>
        body { padding-top: 70px; overflow-x: hidden; }
        .page-header-section {
            background: linear-gradient(135deg, #20c997 0%, #198754 100%); /* Зеленый градиент */
            color: white;
            padding: 4rem 1.5rem;
            margin-bottom: 2rem;
            border-radius: .3rem;
            text-align: center;
        }
        .page-header-section img.header-icon { 
            width: 80px; height: 80px; margin-bottom: 1rem; filter: brightness(0) invert(1);
        }

        .content-section { 
            margin-bottom: 3rem; 
            opacity: 0; 
            transform: translateY(40px);
        }
        .content-section h3, .content-section h4 { 
            margin-bottom: 1.5rem; display: flex; align-items: center; 
            font-weight: 600; color: #343a40;
        }
        .content-section h3 img.section-icon, .content-section h4 img.section-icon { 
            width: 45px; height: 45px; margin-right: 0.8rem; opacity: 0.8;
        }
        .content-section p, .content-section li { line-height: 1.7; color: #495057; }

        /* Схема "Как коммуникации влияют" */
        .communication-flow-diagram { display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; }
        .flow-step { text-align: center; padding: 1rem; margin: 0.5rem; background-color: #f8f9fa; border-radius: .3rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; min-width:150px; }
        .flow-step:hover { transform: translateY(-5px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .flow-step img { width: 40px; height: 40px; margin-bottom: 0.5rem; }
        .flow-arrow { font-size: 2rem; color: #6c757d; align-self: center; }

        /* Признаки здоровой оргкультуры */
        .culture-card { background-color: #fff; border: 1px solid #eee; padding: 1rem; border-radius: .3rem; text-align: center; cursor: pointer; transition: all 0.3s ease; }
        .culture-card:hover { transform: scale(1.05); box-shadow: 0 0.5rem 1rem rgba(0,0,0,.1); border-color: var(--bs-primary); }
        .culture-card img { width: 30px; height: 30px; margin-bottom: 0.5rem; }
        #cultureDetailModal .modal-title img { margin-right: 10px; }

        /* Коммуникации с волонтерами */
        .volunteer-comms-list .list-group-item { cursor: pointer; }
        .volunteer-comms-list .list-group-item .details { display: none; margin-top: 0.5rem; font-size: 0.9em; color: #555; padding-left: 1.5rem; border-left: 3px solid #cfe2ff;}

        /* Инструменты */
        .tool-category-card {
            background-color: #fff; border-radius: .5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            padding: 1.5rem; margin-bottom: 1.5rem; cursor: pointer;
        }
        .tool-category-card h5 { color: var(--bs-info); }
        .tool-examples { display: none; margin-top: 1rem; padding-left: 1rem; border-left: 3px solid var(--bs-info-bg-subtle); }
        .tool-examples p { margin-bottom: 0.3rem; font-size: 0.95rem; }

        /* Диагностика проблем */
        .problem-solution-card {
            perspective: 1000px;
            margin-bottom: 1.5rem;
        }
        .flipper {
            position: relative;
            width: 100%;
            min-height: 120px; /* Adjust as needed */
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .problem-solution-card.flipped .flipper { transform: rotateY(180deg); }
        .problem-card, .solution-card {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            padding: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: .3rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .problem-card { background-color: #f8d7da; color: #58151c; } /* danger-subtle */
        .solution-card { background-color: #d1e7dd; color: #0a3622; transform: rotateY(180deg); } /* success-subtle */
        
        /* Интерактив "3 инструмента" */
        #toolsImprovementInteractive { background-color: #f8f9fa; padding: 2rem; border-radius: .5rem; }
        #aiToolsFeedbackContainer { display: none; margin-top: 1.5rem;}
        #aiToolsFeedbackResult { white-space: pre-wrap; }

        /* Кнопка экспорта в PDF */
        #exportSectionResultsBtn {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            font-weight: 500;
            color: #fff;
            background-color: #198754;
            border: none;
            border-radius: .3rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #exportSectionResultsBtn:hover {
            background-color: #157347;
        }

        /* Новый стиль для блока с коммуникациями с волонтерами */
        .bg-volunteer-blue {
          background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
          color: #fff;
        }
        .volunteer-comms-list-cards .list-group-item {
          background: #fff !important;
          color: #222 !important;
          border: none;
          box-shadow: 0 2px 8px rgba(30,64,175,0.08);
          margin-bottom: 1rem;
          border-radius: 1rem !important;
          transition: box-shadow 0.2s, transform 0.2s;
        }
        .volunteer-comms-list-cards .list-group-item.active,
        .volunteer-comms-list-cards .list-group-item:hover {
          box-shadow: 0 4px 16px rgba(30,64,175,0.16);
          transform: translateY(-2px) scale(1.02);
        }
        .volunteer-comms-list-cards .list-group-item strong {
          color: #2563eb;
        }
        .volunteer-comms-list-cards .details {
          background: #f1f5fb;
          color: #1e293b;
          border-left: 3px solid #3b82f6;
          border-radius: 0 0 0.7rem 0.7rem;
          margin-top: 0.5rem;
          padding: 0.7rem 1rem 0.7rem 1.2rem;
          font-size: 0.97em;
          box-shadow: 0 1px 4px rgba(30,64,175,0.06);
        }
        .bg-volunteer-blue .list-group-item {
          background: #fff !important;
        }

        /* Новый стиль для коммуникаций с волонтерами (современные карточки) */
        .volunteer-comms-list-modern {
          list-style: none;
          padding: 0;
          margin: 0 0 2rem 0;
          display: flex;
          flex-wrap: wrap;
          gap: 1.2rem;
        }
        .volunteer-comms-item {
          background: linear-gradient(135deg, #e3f0ff 0%, #cfe2ff 100%);
          border-left: 5px solid #0d6efd;
          border-radius: .7rem;
          box-shadow: 0 2px 10px rgba(13,110,253,0.07);
          padding: 1.1rem 1.3rem 0.7rem 1.3rem;
          color: #212529;
          min-width: 260px;
          flex: 1 1 320px;
          position: relative;
          transition: box-shadow 0.2s, transform 0.2s;
          cursor: pointer;
        }
        .volunteer-comms-item:hover {
          box-shadow: 0 6px 18px rgba(13,110,253,0.13);
          transform: translateY(-3px) scale(1.03);
        }
        .comms-main {
          font-size: 1.13rem;
          font-weight: 600;
          color: #0d387d;
          margin-bottom: 0.3rem;
        }
        .comms-details {
          background: #fff;
          color: #333;
          border-radius: .5rem;
          margin-top: 0.2rem;
          padding: 0.7rem 1rem 0.7rem 1rem;
          font-size: 0.98rem;
          box-shadow: 0 1px 6px rgba(13,110,253,0.07);
          transition: background 0.2s;
        }
        @media (max-width: 768px) {
          .volunteer-comms-list-modern { flex-direction: column; gap: 0.8rem; }
          .volunteer-comms-item { min-width: 0; }
        }

        .comms-tools-row { margin-bottom: 2rem; }
.comms-flip-card {
  background: transparent;
  perspective: 1200px;
  min-height: 220px;
  cursor: pointer;
}
.comms-flip-inner {
  position: relative;
  width: 100%;
  height: 100%;
  min-height: 220px;
  transition: transform 0.7s cubic-bezier(.4,1.6,.4,1);
  transform-style: preserve-3d;
}
.comms-flip-card.flipped .comms-flip-inner {
  transform: rotateY(180deg);
}
.comms-flip-front, .comms-flip-back {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 1.2rem;
  box-shadow: 0 6px 32px rgba(30,64,175,0.13), 0 1.5px 6px rgba(0,0,0,0.07);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  padding: 2rem 1.5rem 1.5rem 1.5rem;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  color: #fff;
  font-size: 1.08rem;
  transition: box-shadow 0.2s, background 0.2s;
}
.comms-flip-front h5 { font-weight: 700; color: #fff; margin-bottom: 0.7rem; }
.comms-flip-front p { color: #e0e7ef; }
.comms-flip-back {
  background: #fff;
  color: #1e293b;
  transform: rotateY(180deg);
  box-shadow: 0 8px 32px rgba(30,64,175,0.18), 0 2px 8px rgba(0,0,0,0.09);
  padding-top: 2.2rem;
}
.comms-flip-back h6 { color: #2563eb; font-weight: 600; }
.comms-flip-back ul { padding-left: 1.1rem; margin-bottom: 0; }
.comms-flip-back li { margin-bottom: 0.4rem; font-size: 1.01rem; }
.comms-flip-messengers .comms-flip-front { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
.comms-flip-tasks .comms-flip-front { background: linear-gradient(135deg, #f59e42 0%, #fbbf24 100%); }
.comms-flip-clouds .comms-flip-front { background: linear-gradient(135deg, #34d399 0%, #059669 100%); }
.comms-flip-knowledge .comms-flip-front { background: linear-gradient(135deg, #a78bfa 0%, #6366f1 100%); }
.comms-flip-card:hover .comms-flip-front, .comms-flip-card.flipped .comms-flip-front {
  box-shadow: 0 12px 36px rgba(30,64,175,0.22), 0 3px 12px rgba(0,0,0,0.13);
}
.comms-flip-card:active .comms-flip-front {
  box-shadow: 0 2px 8px rgba(30,64,175,0.10);
}
@media (max-width: 768px) {
  .comms-flip-card, .comms-flip-inner { min-height: 180px; }
  .comms-flip-front, .comms-flip-back { padding: 1.2rem 1rem 1rem 1rem; }
}

/* --- Новый стиль для флип-карточек диагностики проблем --- */
.diagnosis-flip-card {
  background: transparent;
  perspective: 1200px;
  min-height: 220px;
  cursor: pointer;
  margin-bottom: 2rem;
}
.diagnosis-flip-inner {
  position: relative;
  width: 100%;
  height: 100%;
  min-height: 220px;
  transition: transform 0.7s cubic-bezier(.4,1.6,.4,1);
  transform-style: preserve-3d;
}
.diagnosis-flip-card.flipped .diagnosis-flip-inner {
  transform: rotateY(180deg);
}
.diagnosis-flip-front, .diagnosis-flip-back {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 1.2rem;
  box-shadow: 0 6px 32px rgba(30,64,175,0.13), 0 1.5px 6px rgba(0,0,0,0.07);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  padding: 2rem 1.5rem 1.5rem 1.5rem;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  font-size: 1.08rem;
  transition: box-shadow 0.2s, background 0.2s;
}
.diagnosis-flip-front {
  background: #f8d7da;
  color: #58151c;
}
.diagnosis-flip-back {
  background: #d1e7dd;
  color: #0a3622;
  transform: rotateY(180deg);
  box-shadow: 0 8px 32px rgba(30,64,175,0.18), 0 2px 8px rgba(0,0,0,0.09);
  padding-top: 2.2rem;
}
.diagnosis-flip-card:hover .diagnosis-flip-front, .diagnosis-flip-card.flipped .diagnosis-flip-front {
  box-shadow: 0 12px 36px rgba(30,64,175,0.22), 0 3px 12px rgba(0,0,0,0.13);
}
.diagnosis-flip-card:active .diagnosis-flip-front {
  box-shadow: 0 2px 8px rgba(30,64,175,0.10);
}
@media (max-width: 768px) {
  .diagnosis-flip-card, .diagnosis-flip-inner { min-height: 180px; }
  .diagnosis-flip-front, .diagnosis-flip-back { padding: 1.2rem 1rem 1rem 1rem; }
}

.feedback-principles-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 1.3rem;
  margin-bottom: 2.5rem;
  justify-content: center;
}
.feedback-principle-card {
  background: linear-gradient(135deg, #e0f7fa 0%, #e3f0ff 100%);
  border-left: 5px solid #0d6efd;
  border-radius: 1rem;
  box-shadow: 0 2px 12px rgba(13,110,253,0.08);
  padding: 1.2rem 1.5rem 1.1rem 1.5rem;
  min-width: 240px;
  max-width: 320px;
  flex: 1 1 260px;
  color: #0d387d;
  font-weight: 600;
  font-size: 1.13rem;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  transition: box-shadow 0.2s, transform 0.2s;
  cursor: pointer;
  overflow: hidden;
}
.feedback-principle-card:hover {
  box-shadow: 0 8px 24px rgba(13,110,253,0.16);
  transform: translateY(-3px) scale(1.03);
}
.principle-desc {
  display: block;
  color: #495057;
  font-weight: 400;
  font-size: 0.99rem;
  margin-top: 0.5rem;
  padding-left: 0.1rem;
}
@media (max-width: 900px) {
  .feedback-principles-grid { flex-direction: column; gap: 1rem; align-items: stretch; }
  .feedback-principle-card { min-width: 0; max-width: 100%; }
}

.nko-carousel-container {
  width: 100%;
  max-width: 900px;
  margin: 0 auto 2.5rem auto;
  position: relative;
  overflow: visible;
  background: linear-gradient(135deg, #e6f9ed 0%, #d1f5e1 100%);
  border-radius: 1.3rem;
  padding: 2.2rem 1.2rem 1.7rem 1.2rem;
  box-shadow: 0 2px 16px rgba(13,110,53,0.07);
}
.nko-carousel-track {
  display: flex;
  gap: 2.5rem;
  justify-content: center;
  align-items: stretch;
  will-change: auto;
}
.nko-carousel-slide {
  background: #f3fcf7;
  border-radius: 1.2rem;
  box-shadow: 0 2px 12px rgba(13,110,53,0.08);
  min-width: 220px;
  max-width: 260px;
  flex: 0 0 240px;
  padding: 2rem 1.2rem 1.2rem 1.2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  color: #176c3a;
  font-weight: 600;
  font-size: 1.13rem;
  position: relative;
  opacity: 1;
  transform: scale(1);
  transition: box-shadow 0.2s, transform 0.3s, opacity 0.3s;
  border: 1.5px solid #b6e2c6;
}
.nko-carousel-slide span {
  display: block;
  font-size: 1.18rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: #176c3a;
}
.nko-carousel-slide .nko-carousel-desc {
  color: #2e4d3a;
  font-weight: 400;
  font-size: 1.01rem;
  margin-top: 0.5rem;
}
.nko-chain-arrow {
  position: absolute;
  right: -32px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 2;
}
.nko-chain-arrow svg path {
  stroke: #1bb86c;
}
@media (max-width: 900px) {
  .nko-carousel-track { gap: 1.2rem; }
  .nko-carousel-slide { min-width: 160px; max-width: 180px; padding: 1.1rem 0.5rem 0.7rem 0.5rem; }
  .nko-chain-arrow { right: -18px; }
  .nko-carousel-container { padding: 1.2rem 0.2rem 1.2rem 0.2rem; }
}
.culture-cards-accordion .culture-card-accordion {
  background: #fff;
  border: 1px solid #e3e8ef;
  border-radius: 1rem;
  box-shadow: 0 2px 10px rgba(13,110,253,0.07);
  padding: 1.1rem 1.2rem 0.7rem 1.2rem;
  color: #0d387d;
  font-weight: 600;
  font-size: 1.08rem;
  margin-bottom: 0.5rem;
  cursor: pointer;
  transition: box-shadow 0.2s, transform 0.2s;
  position: relative;
}
.culture-cards-accordion .culture-card-accordion:hover {
  box-shadow: 0 8px 24px rgba(13,110,253,0.13);
  transform: translateY(-2px) scale(1.03);
}
.culture-card-header {
  display: flex;
  align-items: center;
  gap: 0.7rem;
  font-size: 1.13rem;
}
.culture-card-body {
  color: #495057;
  font-weight: 400;
  font-size: 0.99rem;
  margin-top: 0.5rem;
  display: none;
  padding-left: 2.2rem;
  padding-top: 0.2rem;
  padding-bottom: 0.2rem;
  border-left: 3px solid #0d6efd;
}
.culture-card-accordion.open .culture-card-body {
  display: block;
  animation: fadeInDown 0.4s cubic-bezier(.4,1.6,.4,1);
}
@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

        /* НАВИГАЦИЯ ПО РАЗДЕЛАМ */
        .section-nav-bar {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(255,255,255,0.97);
            box-shadow: 0 2px 8px rgba(32,201,151,0.07);
            padding: 0.5rem 0;
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
        }
        .section-nav-btn {
            padding: 0.4rem 1rem;
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 0.5rem;
            transition: background-color 0.3s, transform 0.3s;
        }
        .section-nav-btn:hover {
            transform: translateY(-2px);
        }
        .section-nav-btn.btn-success {
            background-color: #198754;
            color: white;
            border-color: #198754;
        }
        .section-nav-btn.btn-success:hover {
            background-color: #157347;
        }
    </style>
</head>

<body>
    <header>
        <!-- ... (Код шапки и полноэкранного меню, как в предыдущих файлах, но с активным пунктом "2. Коммуникации") ... -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top shadow-sm">
            <div class="container">
                <a class="navbar-brand fw-bold d-flex align-items-center" href="../index.html">
                    <img src="../assets/images/logo.svg" alt="Лого НКО"> 
                    Семинар НКО
                </a>
                <button class="navbar-custom-toggler ms-auto" aria-label="Открыть меню" id="customMenuToggler" aria-expanded="false">
                    <svg viewBox="0 0 100 80" width="30" height="30" id="actualBurgerIcon" fill="currentColor">
                        <rect class="line line1" x="0" y="10" width="100" height="10" rx="5"></rect>
                        <rect class="line line2" x="0" y="35" width="100" height="10" rx="5"></rect>
                        <rect class="line line3" x="0" y="60" width="100" height="10" rx="5"></rect>
                    </svg>
                </button>
            </div>
        </nav>
    </header>

    <div class="fullscreen-menu" id="fullscreenMenu">
        <button class="close-menu-btn" id="closeFullscreenMenu" aria-label="Закрыть меню">×</button>
        <ul class="navbar-nav-fullscreen">
            <li class="nav-item fs-menu-item">
                <a class="nav-link" href="../index.html">Главная</a>
            </li>
            <li class="nav-item fs-menu-item custom-dropdown">
                <a class="nav-link dropdown-toggle-custom active" aria-current="page" href="#" id="sectionsDropdownCustomFs" role="button" aria-expanded="false">
                    Разделы
                </a>
                <ul class="dropdown-menu-custom">
                    <li><a class="dropdown-item" href="0_introduction.html">0. Введение</a></li>
                    <li><a class="dropdown-item" href="1_community_building.html">1. Сообщество</a></li>
                    <li><a class="dropdown-item active" href="2_internal_communications.html">2. Коммуникации</a></li>
                    <li><a class="dropdown-item" href="3_infrastructure.html">3. Инфраструктура</a></li>
                    <li><a class="dropdown-item" href="4_legal_and_security.html">4. Безопасность</a></li>
                    <li><a class="dropdown-item" href="5_effectiveness_and_development.html">5. Эффективность</a></li>
                    <li><a class="dropdown-item" href="6_crisis_management.html">6. Антикризис</a></li>
                    <li><a class="dropdown-item" href="7_fundraising.html">7. Фандрайзинг</a></li>
                    <li><a class="dropdown-item" href="8_cases_and_practice.html">8. Практика и кейсы</a></li>
                </ul>
            </li>
            <li class="nav-item fs-menu-item">
                <a class="nav-link" href="useful_resources.html">Полезные ресурсы</a>
            </li>
        </ul>
    </div>

    <!-- НАВИГАЦИЯ ПО РАЗДЕЛАМ -->
    <nav class="section-nav-bar" style="position:sticky;top:0;z-index:1000;background:rgba(255,255,255,0.97);box-shadow:0 2px 8px rgba(32,201,151,0.07);padding:0.5rem 0 0.5rem 0;display:flex;gap:0.5rem;justify-content:center;align-items:center;">
      <a href="0_introduction.html" class="btn btn-outline-success section-nav-btn">Введение</a>
      <a href="1_community_building.html" class="btn btn-outline-success section-nav-btn">1. Сообщество</a>
      <a href="2_internal_communications.html" class="btn btn-success section-nav-btn">2. Коммуникации</a>
      <a href="3_infrastructure.html" class="btn btn-outline-success section-nav-btn">3. Инфраструктура</a>
      <a href="4_legal_and_security.html" class="btn btn-outline-success section-nav-btn">4. Право и безопасность</a>
      <a href="5_effectiveness_and_development.html" class="btn btn-outline-success section-nav-btn">5. Эффективность</a>
      <a href="6_crisis_management.html" class="btn btn-outline-success section-nav-btn">6. Кризисы</a>
      <a href="7_fundraising.html" class="btn btn-outline-success section-nav-btn">7. Фандрайзинг</a>
      <a href="8_cases_and_practice.html" class="btn btn-outline-success section-nav-btn">8. Кейсы</a>
      <a href="useful_resources.html" class="btn btn-outline-secondary section-nav-btn">Ресурсы</a>
    </nav>
    <!-- /НАВИГАЦИЯ ПО РАЗДЕЛАМ -->

    <main>
        <div class="page-header-section">
            <img src="../assets/icons/communication.svg" alt="Внутренние коммуникации" class="header-icon">
            <h1 class="display-5 fw-bold">Внутренние Коммуникации</h1>
            <p class="lead">Фундамент эффективности вашей команды: как наладить общение, которое вдохновляет и ведет к результату.</p>
        </div>

        <div class="container py-4">
            <!-- 2.1-2.2. Фундамент Эффективности -->
            <section class="content-section" id="s2-1">
                <h3>
                    <img src="../assets/icons/efficiency.svg" alt="Фундамент" class="section-icon">
                    Роль внутренних коммуникаций
                </h3>
                <h4>Как коммуникации влияют на НКО?</h4>
                <div class="nko-carousel-container mb-4">
                  <div class="nko-carousel-track">
                    <div class="nko-carousel-slide" data-title="Миссия и Ценности">
                      <img src="../assets/icons/introngo.svg" alt="Миссия"><span>Миссия</span>
                      <div class="nko-carousel-desc">Четко донесенные миссия и ценности объединяют команду вокруг общей цели.</div>
                    </div>
                    <div class="nko-carousel-slide" data-title="Команда">
                      <img src="../assets/icons/community.svg" alt="Команда"><span>Команда</span>
                      <div class="nko-carousel-desc">Эффективное общение помогает формировать сплоченную команду, где каждый понимает свою роль.</div>
                    </div>
                    <div class="nko-carousel-slide" data-title="Мотивация и Вовлеченность">
                      <img src="../assets/icons/interactivity.svg" alt="Мотивация"><span>Мотивация</span>
                      <div class="nko-carousel-desc">Открытый диалог, признание вклада и обратная связь повышают мотивацию и вовлеченность сотрудников и волонтеров.</div>
                    </div>
                    <div class="nko-carousel-slide" data-title="Результат">
                      <img src="../assets/icons/cases.svg" alt="Результат"><span>Результат</span>
                      <div class="nko-carousel-desc">Слаженная и мотивированная команда, объединенная общей целью, достигает лучших результатов в своей деятельности.</div>
                    </div>
                  </div>
                </div>

                <h4 class="mt-4"><img src="../assets/icons/practical.svg" alt="Оргкультура" class="section-icon">Признаки здоровой организационной культуры <small class="text-muted fs-6 ms-1">(Нажмите на признак)</small></h4>
                <div class="row culture-cards-accordion">
                  <div class="col-md-3 mb-3">
                    <div class="culture-card-accordion">
                      <div class="culture-card-header"><img src="../assets/icons/safety.svg" alt="">Доверие</div>
                      <div class="culture-card-body">Люди не боятся высказывать свое мнение, признавать ошибки и полагаться друг на друга. Руководство доверяет команде выполнение задач.</div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="culture-card-accordion">
                      <div class="culture-card-header"><img src="../assets/icons/communication.svg" alt="">Открытость</div>
                      <div class="culture-card-body">Информация свободно циркулирует в обе стороны. Решения принимаются прозрачно, команда понимает, почему происходят те или иные изменения.</div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="culture-card-accordion">
                      <div class="culture-card-header"><img src="../assets/icons/community.svg" alt="">Поддержка</div>
                      <div class="culture-card-body">Члены команды помогают друг другу, готовы делиться знаниями и опытом. Существует культура взаимопомощи и наставничества.</div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="culture-card-accordion">
                      <div class="culture-card-header"><img src="../assets/icons/visibility.svg" alt="">Прозрачность</div>
                      <div class="culture-card-body">Касается как принятия решений, так и финансовых потоков (в разумных пределах). Сотрудники и волонтеры понимают, как работает НКО.</div>
                    </div>
                  </div>
                </div>

                 <h4 class="mt-4"><img src="../assets/icons/volunteer_activism.svg" alt="Волонтеры" class="section-icon">Коммуникации с волонтерами: Ключевые моменты</h4>
                <ul class="volunteer-comms-list-modern">
                  <li class="volunteer-comms-item">
                    <div class="comms-main"><strong>Четкие ожидания:</strong></div>
                    <div class="comms-details">С самого начала объясните задачи, объем работы, требуемое время и стандарты.</div>
                  </li>
                  <li class="volunteer-comms-item">
                    <div class="comms-main"><strong>Регулярная обратная связь:</strong></div>
                    <div class="comms-details">Благодарите за вклад, отмечайте успехи, конструктивно обсуждайте зоны роста.</div>
                  </li>
                  <li class="volunteer-comms-item">
                    <div class="comms-main"><strong>Каналы связи:</strong></div>
                    <div class="comms-details">Определите удобные и доступные каналы для общения (чат, email, встречи).</div>
                  </li>
                  <li class="volunteer-comms-item">
                    <div class="comms-main"><strong>Вовлечение и признание:</strong></div>
                    <div class="comms-details">Приглашайте волонтеров на общие встречи, делитесь новостями НКО, отмечайте их вклад публично (с их согласия).</div>
                  </li>
                  <li class="volunteer-comms-item">
                    <div class="comms-main"><strong>Обучение и поддержка:</strong></div>
                    <div class="comms-details">Предоставляйте необходимые инструкции, материалы и поддержку по возникающим вопросам.</div>
                  </li>
                </ul>
            </section>
            
            <!-- Модальное окно для деталей признаков оргкультуры -->
            <div class="modal fade" id="cultureDetailModal" tabindex="-1" aria-labelledby="cultureDetailModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="cultureDetailModalLabel"><img src="../assets/icons/practical.svg" alt="" width="24" height="24"> <span></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body" id="cultureDetailModalBody"></div>
                </div>
              </div>
            </div>


            <!-- Инструменты Внутренних Коммуникаций -->
            <section class="content-section" id="s2-3">
                <h3>
                    <img src="../assets/icons/low_budget.svg" alt="Инструменты" class="section-icon">
                    Инструменты Внутренних Коммуникаций
                </h3>
                <p>Подбор правильных инструментов облегчает общение и координацию в команде. Вот несколько малобюджетных вариантов:</p>
                <div class="row comms-tools-row">
                    <div class="col-md-6 mb-4">
                        <div class="comms-flip-card comms-flip-messengers">
                            <div class="comms-flip-inner">
                                <div class="comms-flip-front">
                                    <h5><img src="../assets/icons/safety.svg" alt="" class="me-2">Мессенджеры</h5>
                                    <p class="text-light small">Для быстрого обмена информацией, групповых чатов.</p>
                                </div>
                                <div class="comms-flip-back">
                                    <h6 class="mb-2">Рекомендуемые инструменты:</h6>
                                    <ul>
                                        <li><strong>Signal</strong> — приватность, e2e-шифрование</li>
                                        <li><strong>Element (Matrix)</strong> — децентрализованный, можно свой сервер</li>
                                        <li><strong>Telegram</strong> — популярный, каналы и чаты</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="comms-flip-card comms-flip-tasks">
                            <div class="comms-flip-inner">
                                <div class="comms-flip-front">
                                    <h5><img src="../assets/icons/cases.svg" alt="" class="me-2">Таск-трекеры</h5>
                                    <p class="text-light small">Для управления задачами, проектами, отслеживания прогресса.</p>
                                </div>
                                <div class="comms-flip-back">
                                    <h6 class="mb-2">Рекомендуемые инструменты:</h6>
                                    <ul>
                                        <li><strong>Trello</strong> — визуальное управление задачами</li>
                                        <li><strong>Asana</strong> — продвинутое управление проектами</li>
                                        <li><strong>Notion</strong> — гибкий таск-трекер и база знаний</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="comms-flip-card comms-flip-clouds">
                            <div class="comms-flip-inner">
                                <div class="comms-flip-front">
                                    <h5><img src="../assets/icons/Infrastructure.svg" alt="" class="me-2">Облака и Видеовстречи</h5>
                                    <p class="text-light small">Для совместной работы над документами и онлайн-совещаний.</p>
                                </div>
                                <div class="comms-flip-back">
                                    <h6 class="mb-2">Рекомендуемые инструменты:</h6>
                                    <ul>
                                        <li><strong>Nextcloud</strong> — безопасное облако</li>
                                        <li><strong>CryptPad</strong> — e2e-шифрование документов</li>
                                        <li><strong>Jitsi Meet</strong> — бесплатные видеовстречи</li>
                                        <li><strong>Google Docs</strong> — совместная работа</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="comms-flip-card comms-flip-knowledge">
                            <div class="comms-flip-inner">
                                <div class="comms-flip-front">
                                    <h5><img src="../assets/icons/efficiency.svg" alt="" class="me-2">База Знаний</h5>
                                    <p class="text-light small">Централизованное хранилище инструкций, регламентов, контактов.</p>
                                </div>
                                <div class="comms-flip-back">
                                    <h6 class="mb-2">Рекомендуемые инструменты:</h6>
                                    <ul>
                                        <li><strong>Notion</strong> — гибкая база знаний</li>
                                        <li><strong>Google Docs</strong> — просто и доступно</li>
                                        <li><strong>Confluence</strong> — корпоративная база знаний</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2.4. Диагностика Проблем и Поиск Решений -->
            <section class="content-section" id="s2-4">
                 <h3>
                    <img src="../assets/icons/interactivity.svg" alt="Диагностика" class="section-icon">
                    Диагностика Проблем и Поиск Решений
                </h3>
                <p>Эффективные коммуникации требуют постоянной диагностики. Кликните на карточку проблемы, чтобы увидеть возможное решение:</p>
                <div class="row diagnosis-tools-row">
                    <div class="col-md-6 diagnosis-flip-card">
                        <div class="diagnosis-flip-inner">
                            <div class="diagnosis-flip-front">
                                <h5>Проблема: Информационная перегрузка</h5>
                                <p class="small">Слишком много чатов, писем, уведомлений</p>
                            </div>
                            <div class="diagnosis-flip-back">
                                <h6>Решение:</h6>
                                <ul>
                                    <li>Четкий регламент использования каналов (что и где обсуждаем).</li>
                                    <li>Фильтрация информации, выделение главного.</li>
                                    <li>Регулярные дайджесты новостей.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 diagnosis-flip-card">
                        <div class="diagnosis-flip-inner">
                            <div class="diagnosis-flip-front">
                                <h5>Проблема: Искажение информации</h5>
                                <p class="small">"Сломанный телефон", слухи</p>
                            </div>
                            <div class="diagnosis-flip-back">
                                <h6>Решение:</h6>
                                <ul>
                                    <li>Использование официальных каналов для важной информации.</li>
                                    <li>Проверка информации перед распространением.</li>
                                    <li>Протоколирование ключевых решений.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 diagnosis-flip-card">
                        <div class="diagnosis-flip-inner">
                            <div class="diagnosis-flip-front">
                                <h5>Проблема: Отсутствие обратной связи</h5>
                                <p class="small">Люди не знают, как их работа оценена</p>
                            </div>
                            <div class="diagnosis-flip-back">
                                <h6>Решение:</h6>
                                <ul>
                                    <li>Внедрение культуры конструктивной обратной связи.</li>
                                    <li>Регулярные встречи 1-на-1 (если применимо).</li>
                                    <li>Анонимные опросы для сбора мнений.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 diagnosis-flip-card">
                        <div class="diagnosis-flip-inner">
                            <div class="diagnosis-flip-front">
                                <h5>Проблема: Низкая вовлеченность волонтеров</h5>
                                <p class="small">Не чувствуют себя частью команды</p>
                            </div>
                            <div class="diagnosis-flip-back">
                                <h6>Решение:</h6>
                                <ul>
                                    <li>Четкие задачи и инструкции.</li>
                                    <li>Регулярное информирование о достижениях НКО.</li>
                                    <li>Приглашение на неформальные встречи. Признание их вклада.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="mt-4"><img src="../assets/icons/practical.svg" alt="Обратная связь" class="section-icon">Принципы конструктивной обратной связи</h3>
<div class="feedback-principles-grid mb-4">
  <div class="feedback-principle-card" data-anim-text>Конкретность
    <span class="principle-desc">Говорите о фактах и поведении, а не о личности.</span>
  </div>
  <div class="feedback-principle-card" data-anim-text>Своевременность
    <span class="principle-desc">Предоставляйте обратную связь как можно скорее после события.</span>
  </div>
  <div class="feedback-principle-card" data-anim-text>Сбалансированность
    <span class="principle-desc">Отмечайте как сильные стороны, так и зоны для роста.</span>
  </div>
  <div class="feedback-principle-card" data-anim-text>Фокус на поведении
    <span class="principle-desc">Обсуждайте то, что человек может изменить.</span>
  </div>
  <div class="feedback-principle-card" data-anim-text>Предложение решений/поддержки
    <span class="principle-desc">Совместно ищите пути улучшения.</span>
  </div>
</div>

                <div id="toolsImprovementInteractive" class="mt-5 shadow-sm">
                    <h3 class="text-center mt-4"><img src="../assets/icons/support.svg" alt="ИИ" class="section-icon"> Ваш вклад: Улучшаем коммуникации!</h3>
                    <p>Какие <strong>3 инструмента или практики</strong> внутренних коммуникаций вы бы внедрили/улучшили в своей НКО в первую очередь и почему? Поделитесь своим опытом или идеями.</p>
                    <div class="mb-3">
                        <label for="tool1_name" class="form-label">1. Инструмент/Практика:</label>
                        <input type="text" class="form-control" id="tool1_name" placeholder="Например, Еженедельный дайджест новостей">
                        <label for="tool1_reason" class="form-label mt-1">Почему это важно/какую проблему решит?</label>
                        <textarea class="form-control" id="tool1_reason" rows="2"></textarea>
                    </div>
                     <div class="mb-3">
                        <label for="tool2_name" class="form-label">2. Инструмент/Практика:</label>
                        <input type="text" class="form-control" id="tool2_name" placeholder="Например, Регулярные встречи команды с четкой повесткой">
                         <label for="tool2_reason" class="form-label mt-1">Почему это важно/какую проблему решит?</label>
                        <textarea class="form-control" id="tool2_reason" rows="2"></textarea>
                    </div>
                     <div class="mb-3">
                        <label for="tool3_name" class="form-label">3. Инструмент/Практика:</label>
                        <input type="text" class="form-control" id="tool3_name" placeholder="Например, Общая база знаний по проектам">
                         <label for="tool3_reason" class="form-label mt-1">Почему это важно/какую проблему решит?</label>
                        <textarea class="form-control" id="tool3_reason" rows="2"></textarea>
                    </div>
                    <button type="button" class="btn btn-info text-dark" id="getToolsAiAdviceBtn">Отправить и получить комментарий ИИ</button>
                    <div id="aiToolsFeedbackContainer" class="mt-3">
                        <h5 class="text-primary">Комментарий от ИИ-помощника:</h5>
                        <div id="aiToolsFeedbackResult" class="p-3 border rounded bg-light-subtle text-muted">
                            <em>Заполните поля и нажмите кнопку...</em>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <footer class="py-4 bg-dark text-white-50 mt-5">
        <!-- ... (Подвал) ... -->
         <div class="container text-center">
             <small>Материалы семинара Школы прав человека им. Елены Боннэр © 2025</small> <br>
             <small><em>Информация на сайте носит ознакомительный характер и была создана для интерактивного семинара.</em></small>
         </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/EasePack.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/TextPlugin.min.js"></script>
    
    <script>
    // --- Добавляем константы Gemini/Gemma API в начало скрипта ---
const GOOGLE_AI_API_KEY = "AIzaSyDl6bLHj4tFonVVBnKDhgIpdrTQuZXmhqo";
const GOOGLE_AI_API_URL_BASE = "https://generativelanguage.googleapis.com/v1beta/models/";
const GOOGLE_AI_MODEL = "gemma-3n-e4b-it";
const GOOGLE_AI_API_URL = `${GOOGLE_AI_API_URL_BASE}${GOOGLE_AI_MODEL}:generateContent?key=${GOOGLE_AI_API_KEY}`;

    document.addEventListener('DOMContentLoaded', () => {
        gsap.registerPlugin(ScrollTrigger, EasePack);

        // --- Код для полноэкранного меню ---
        const customMenuToggler = document.getElementById('customMenuToggler');
        const fullscreenMenu = document.getElementById('fullscreenMenu');
        const closeFullscreenMenuBtn = document.getElementById('closeFullscreenMenu');
        
        if (customMenuToggler && fullscreenMenu) {
            const fsNav = fullscreenMenu.querySelector('.navbar-nav-fullscreen');
            const fsMenuItems = fsNav ? gsap.utils.toArray(fsNav.querySelectorAll('.fs-menu-item > a, .fs-menu-item > .dropdown-toggle-custom')) : [];
            const fsSubMenuItemsContainer = fsNav ? fsNav.querySelector('.fs-menu-item.custom-dropdown .dropdown-menu-custom') : null;

            const actualBurgerIcon = customMenuToggler.querySelector('svg');
            const burgerLine1 = actualBurgerIcon ? actualBurgerIcon.querySelector('.line1') : null;
            const burgerLine2 = actualBurgerIcon ? actualBurgerIcon.querySelector('.line2') : null;
            const burgerLine3 = actualBurgerIcon ? actualBurgerIcon.querySelector('.line3') : null;
            
            let burgerTimeline = gsap.timeline({ paused: true, reversed: true });

            if (burgerLine1 && burgerLine2 && burgerLine3) {
                const line1YInitial = parseFloat(burgerLine1.getAttribute('y'));
                const line2YInitial = parseFloat(burgerLine2.getAttribute('y'));
                const line3YInitial = parseFloat(burgerLine3.getAttribute('y'));
                
                if (!isNaN(line1YInitial) && !isNaN(line2YInitial) && !isNaN(line3YInitial)) {
                    burgerTimeline
                        .to(burgerLine1, { duration: 0.25, attr:{y: line2YInitial}, ease: "power2.inOut" }, "cross")
                        .to(burgerLine3, { duration: 0.25, attr:{y: line2YInitial}, ease: "power2.inOut" }, "cross")
                        .to(burgerLine2, { duration: 0.2, scaleX: 0, transformOrigin: "50% 50%", ease: "power2.in" }, "cross") 
                        .to(burgerLine1, { duration: 0.25, rotation: 45,  transformOrigin: "50% 50%", ease: "power2.out" }, "crossEnd")
                        .to(burgerLine3, { duration: 0.25, rotation: -45, transformOrigin: "50% 50%", ease: "power2.out" }, "crossEnd");
                } else {
                     burgerTimeline.to(actualBurgerIcon, {rotation: 180, duration: 0.3, ease:"power2.inOut"});
                }
            } else if (actualBurgerIcon) {
                burgerTimeline.to(actualBurgerIcon, {rotation: 180, duration: 0.3, ease:"power2.inOut"});
            }

            let fsMenuIsOpen = false;
            gsap.set(fullscreenMenu, { display: 'none', autoAlpha: 0 }); 
            if (fsMenuItems.length > 0) {
                gsap.set(fsMenuItems, { autoAlpha: 0, y: 20 });
            }
            if (fsSubMenuItemsContainer) {
                gsap.set(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), {autoAlpha:0, y:10});
            }

            const openFullscreenMenu = () => { 
                if (fsMenuIsOpen) return;
                fsMenuIsOpen = true;
                
                fullscreenMenu.style.display = 'flex';
                burgerTimeline.play();
                customMenuToggler.classList.add('open');
                customMenuToggler.setAttribute('aria-expanded', 'true');

                const tlOpen = gsap.timeline();
                tlOpen.to(fullscreenMenu, { autoAlpha: 1, duration: 0.35, ease: 'power1.out' });
                
                if (fsMenuItems.length > 0) {
                    tlOpen.to(fsMenuItems, { autoAlpha: 1, y: 0, duration: 0.3, stagger: 0.06, ease: 'power1.out' }, "-=0.2");
                }
                
                const sectionsDropdownCustomFs = document.getElementById('sectionsDropdownCustomFs');
                if (sectionsDropdownCustomFs && sectionsDropdownCustomFs.classList.contains('active') && fsSubMenuItemsContainer) {
                    if (sectionsDropdownCustomFs.getAttribute('aria-expanded') === 'true' || fsSubMenuItemsContainer.style.height === 'auto') {
                        tlOpen.to(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), 
                            { autoAlpha:1, y:0, duration: 0.2, stagger: 0.04, ease: 'power1.out' }, "-=0.1");
                    }
                }
            };
            
            const closeFullscreenMenu = () => {
                if (!fsMenuIsOpen) return;
                fsMenuIsOpen = false;

                burgerTimeline.reverse();
                customMenuToggler.classList.remove('open');
                customMenuToggler.setAttribute('aria-expanded', 'false');
                
                const tlClose = gsap.timeline({
                    onComplete: () => {
                        fullscreenMenu.style.display = 'none';
                        if (fsSubMenuItemsContainer && (fsSubMenuItemsContainer.style.height !== '0px' && fsSubMenuItemsContainer.style.height !== '' && fsSubMenuItemsContainer.style.height !== null)) {
                            gsap.set(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), {autoAlpha:0, y:10});
                            gsap.set(fsSubMenuItemsContainer, { height: 0, autoAlpha: 0, marginTop: 0, marginBottom: 0});
                            const sectionsDropdownCustomFs = document.getElementById('sectionsDropdownCustomFs');
                            if(sectionsDropdownCustomFs) sectionsDropdownCustomFs.setAttribute('aria-expanded', 'false');
                        }
                    }
                });
                
                if (fsSubMenuItemsContainer && (fsSubMenuItemsContainer.style.height !== '0px' && fsSubMenuItemsContainer.style.height !== '' && fsSubMenuItemsContainer.style.height !== null)) {
                    tlClose.to(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), 
                        { autoAlpha:0, y:10, duration:0.15, stagger: {each:0.03, from:"end"}, ease:'power1.in' });
                }
                
                if (fsMenuItems.length > 0) {
                    tlClose.to(fsMenuItems, 
                        { autoAlpha: 0, y: 15, duration: 0.2, stagger: { each: 0.04, from: "end" }, ease: 'power1.in' }, 
                        fsSubMenuItemsContainer ? "-=0.1" : 0
                    );
                }
                
                tlClose.to(fullscreenMenu, { 
                    autoAlpha: 0, 
                    duration: 0.25, 
                    ease: 'power1.in'
                }, fsMenuItems.length > 0 ? "-=0.1" : 0);
            };

            customMenuToggler.addEventListener('click', () => { 
                fsMenuIsOpen ? closeFullscreenMenu() : openFullscreenMenu(); 
            });
            
            if (closeFullscreenMenuBtn) {
                closeFullscreenMenuBtn.addEventListener('click', closeFullscreenMenu);
            }
            
            document.addEventListener('keydown', (e) => { 
                if (e.key === 'Escape' && fsMenuIsOpen) closeFullscreenMenu(); 
            });
            
            const sectionsDropdownCustomFs = document.getElementById('sectionsDropdownCustomFs');
            
            if (sectionsDropdownCustomFs && fsSubMenuItemsContainer) {
                gsap.set(fsSubMenuItemsContainer, { height: 0, autoAlpha: 0, marginTop:0, marginBottom:0 });
                gsap.set(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), {autoAlpha:0, y:10});
                
                let subMenuFsIsOpen = false;
                sectionsDropdownCustomFs.addEventListener('click', (e) => {
                    e.preventDefault();
                    subMenuFsIsOpen = !subMenuFsIsOpen;
                    sectionsDropdownCustomFs.setAttribute('aria-expanded', subMenuFsIsOpen.toString());
                    
                    if (subMenuFsIsOpen) {
                        gsap.timeline()
                            .to(fsSubMenuItemsContainer, { 
                                height: 'auto', autoAlpha: 1, marginTop: '0.5rem', marginBottom: '0.5rem', 
                                duration: 0.3, ease: 'power1.out' 
                            })
                            .to(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), { 
                                autoAlpha:1, y:0, duration:0.25, stagger:0.05, ease:'power1.out' 
                            }, "-=0.2");
                    } else {
                        gsap.timeline()
                            .to(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item'), { 
                                autoAlpha:0, y:10, duration:0.2, stagger:{each:0.04, from:"end"}, ease:'power1.in' 
                            })
                            .to(fsSubMenuItemsContainer, { 
                                height: 0, autoAlpha: 0, marginTop: 0, marginBottom: 0, 
                                duration: 0.3, ease: 'power1.in' 
                            }, "-=0.1");
                    }
                });
                
                const fsSubMenuLinks = fsSubMenuItemsContainer ? 
                    gsap.utils.toArray(fsSubMenuItemsContainer.querySelectorAll('a.dropdown-item')) : [];
                
                fsSubMenuLinks.forEach(link => {
                    link.addEventListener('mouseenter', () => {
                        gsap.to(link, { color: '#0d6efd', x: 3, duration: 0.2 });
                    });
                    link.addEventListener('mouseleave', () => {
                        gsap.to(link, { 
                            color: (link.classList.contains('active') ? '#0d6efd' : '#495057'), 
                            x: 0, duration: 0.2 
                        });
                    });
                });
            }
            
            const activeFsDropdownItem = fullscreenMenu.querySelector('.dropdown-menu-custom a.dropdown-item.active');
            if (activeFsDropdownItem) {
                activeFsDropdownItem.style.color = '#0d6efd';
                activeFsDropdownItem.style.fontWeight = '500';
            }
        }

        // --- ОБЩИЕ АНИМАЦИИ СТРАНИЦЫ ---
        gsap.from(".page-header-section h1", {duration: 0.8, y: -50, opacity: 0, ease: "power2.out", delay: 0.2});
        gsap.from(".page-header-section p.lead", {duration: 0.8, y: -30, opacity: 0, ease: "power2.out", delay: 0.4});
        gsap.from(".page-header-section .header-icon", {duration: 1, scale: 0.5, opacity: 0, ease: "back.out(1.7)", delay: 0.1});

        const contentSections = gsap.utils.toArray('.content-section');
        contentSections.forEach(section => {
            gsap.to(section, { 
                opacity: 1, y: 0, duration: 0.7, ease: "power1.out",
                scrollTrigger: { trigger: section, start: "top 90%", once: true }
            });
        });
        
        // Инициализация popovers
        const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
        popoverTriggerList.map(function (popoverTriggerEl) {
          return new bootstrap.Popover(popoverTriggerEl, { html: true, sanitize: false }); // sanitize: false если доверяете контенту data-bs-content
        });

        // Интерактив для "Признаки здоровой оргкультуры"
        const cultureDetailModal = document.getElementById('cultureDetailModal');
        if (cultureDetailModal) {
            cultureDetailModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                const title = button.dataset.title;
                const details = button.dataset.details;
                const modalTitle = cultureDetailModal.querySelector('.modal-title span');
                const modalBody = cultureDetailModal.querySelector('.modal-body');
                modalTitle.textContent = title;
                modalBody.textContent = details;
            });
        }

        // Интерактив для "Коммуникации с волонтерами" (раскрывашки)
        document.querySelectorAll('.volunteer-comms-list .list-group-item').forEach(item => {
            const detailsDiv = item.querySelector('.details');
            if (detailsDiv) {
                gsap.set(detailsDiv, { height: 0, autoAlpha: 0, marginTop: 0, marginBottom:0, display:'block' });
                item.addEventListener('click', () => {
                    const isActive = item.classList.toggle('active');
                    gsap.to(detailsDiv, {
                        height: isActive ? 'auto' : 0,
                        autoAlpha: isActive ? 1 : 0,
                        marginTop: isActive ? '0.5rem' : 0,
                        duration: 0.3,
                        ease: 'power1.inOut'
                    });
                });
            }
        });

        // Интерактив для "Инструменты" (раскрывашки)
        document.querySelectorAll('.tool-category-card').forEach(card => {
            const detailsDiv = card.querySelector('.tool-examples');
            if(detailsDiv) {
                gsap.set(detailsDiv, { height: 0, autoAlpha: 0, marginTop: 0 });
                card.addEventListener('click', () => {
                    const isActive = card.classList.toggle('active');
                     gsap.to(detailsDiv, {
                        height: isActive ? 'auto' : 0,
                        autoAlpha: isActive ? 1 : 0,
                        marginTop: isActive ? '1rem' : 0,
                        duration: 0.3,
                        ease: 'power1.inOut'
                    });
                });
            }
        });
        
        // Интерактив для "Проблема/Решение" (флип-карты)
        document.querySelectorAll('.problem-solution-card').forEach(card => {
            card.addEventListener('click', () => {
                card.classList.toggle('flipped');
            });
        });

        // GSAP flip-анимация для карточек инструментов
const flipCards = document.querySelectorAll('.comms-flip-card');
flipCards.forEach(card => {
  const inner = card.querySelector('.comms-flip-inner');
  let flipped = false;
  gsap.set(inner, {rotateY: 0});
  card.addEventListener('click', function(e) {
    if (e.target.tagName === 'A') return;
    flipped = !flipped;
    gsap.to(inner, {
      rotateY: flipped ? 180 : 0,
      duration: 0.7,
      ease: 'power3.inOut',
      onStart: () => {
        card.classList.add('flipping');
      },
      onComplete: () => {
        card.classList.toggle('flipped', flipped);
        card.classList.remove('flipping');
      }
    });
  });
});
// GSAP flip-анимация для карточек диагностики проблем
const diagnosisCards = document.querySelectorAll('.diagnosis-flip-card');
diagnosisCards.forEach(card => {
  const inner = card.querySelector('.diagnosis-flip-inner');
  let flipped = false;
  gsap.set(inner, {rotateY: 0});
  card.addEventListener('click', function(e) {
    if (e.target.tagName === 'A') return;
    flipped = !flipped;
    gsap.to(inner, {
      rotateY: flipped ? 180 : 0,
      duration: 0.7,
      ease: 'power3.inOut',
      onStart: () => {
        card.classList.add('flipping');
      },
      onComplete: () => {
        card.classList.toggle('flipped', flipped);
        card.classList.remove('flipping');
      }
    });
  });
});

        // Интерактив "3 инструмента" с ИИ
        const getToolsAiAdviceBtn = document.getElementById('getToolsAiAdviceBtn');
        const aiToolsFeedbackContainer = document.getElementById('aiToolsFeedbackContainer');
        const aiToolsFeedbackResultEl = document.getElementById('aiToolsFeedbackResult');

        if (getToolsAiAdviceBtn && aiToolsFeedbackContainer && aiToolsFeedbackResultEl) {
            gsap.set(aiToolsFeedbackContainer, {display: 'none', autoAlpha:0});
            getToolsAiAdviceBtn.addEventListener('click', async () => {
                const tool1_name = document.getElementById('tool1_name').value;
                const tool1_reason = document.getElementById('tool1_reason').value;
                const tool2_name = document.getElementById('tool2_name').value;
                const tool2_reason = document.getElementById('tool2_reason').value;
                const tool3_name = document.getElementById('tool3_name').value;
                const tool3_reason = document.getElementById('tool3_reason').value;

                if (!tool1_name && !tool2_name && !tool3_name) {
                    alert("Пожалуйста, предложите хотя бы один инструмент или практику.");
                    return;
                }
                
                gsap.timeline().set(aiToolsFeedbackContainer, {display: 'block'}).to(aiToolsFeedbackContainer, {autoAlpha:1, y:0, duration:0.4, ease: 'power2.out'});
                aiToolsFeedbackResultEl.innerHTML = '<em>🤖 ИИ анализирует ваши предложения...</em>';
                gsap.fromTo(aiToolsFeedbackResultEl, {opacity:0.5, y:5}, {opacity:1, y:0, duration:0.3});

                try {
                    // Сохраняем системный промпт, но используем Gemini/Gemma API (только role: 'user')
                    const systemPrompt = "Ты — ИИ-эксперт по внутренним коммуникациям в НКО. Твоя задача — дать конструктивный и краткий фидбэк на предложения пользователя. Будь краток и по существу. Ответ на русском.";
                    const userPrompt = `Пользователь НКО предлагает следующие инструменты/практики для улучшения внутренних коммуникаций:\n1. Инструмент/Практика: ${tool1_name || "Не указано"}\n   Причина/Проблема: ${tool1_reason || "Не указано"}\n\n2. Инструмент/Практика: ${tool2_name || "Не указано"}\n   Причина/Проблема: ${tool2_reason || "Не указано"}\n\n3. Инструмент/Практика: ${tool3_name || "Не указано"}\n   Причина/Проблема: ${tool3_reason || "Не указано"}\n\nДай краткий и конструктивный комментарий по этим предложениям. Оцени их релевантность для НКО. Можешь предложить дополнительные мысли или альтернативы, если это уместно. Кратко. Ответ на русском.`;
                    const fullPrompt = `${systemPrompt}\n\n${userPrompt}`;
                    const response = await fetch(GOOGLE_AI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [
                                { role: "user", parts: [{ text: fullPrompt }] }
                            ],
                            generationConfig: {
                                temperature: 0.6,
                                maxOutputTokens: 700
                            }
                        })
                    });
                    if (!response.ok) throw new Error(`Ошибка сети: ${response.status}`);
                    const data = await response.json();
                    let aiMessage = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "Не удалось получить комментарий от ИИ.";
                    
                    aiMessage = aiMessage.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>').replace(/^\s*-\s*(.*)/gm, '<li>$1</li>');
                    if (aiMessage.includes('<li>')) {
                       aiMessage = aiMessage.replace(/(<li>.*?<\/li>\s*)+/g, (match) => `<ul>${match}</ul>`);
                       aiMessage = aiMessage.replace(/<\/ul>\s*<ul>/g, '');
                    }
                    aiMessage = aiMessage.replace(/\n/g, '<br>');

                    gsap.to(aiToolsFeedbackResultEl, {opacity:0, y:-5, duration: 0.2, onComplete: () => {
                        aiToolsFeedbackResultEl.innerHTML = aiMessage;
                        gsap.to(aiToolsFeedbackResultEl, {opacity:1, y:0, duration:0.4, ease: 'power2.out'});
                    }});

                } catch (error) {

                    console.error('AI Tools Advice Error:', error);
                    gsap.to(aiToolsFeedbackResultEl, {opacity:0, y:-5, duration: 0.2, onComplete: () => {
                        aiToolsFeedbackResultEl.innerHTML = `😥 Ошибка получения совета от ИИ. <small>${error.message}</small>`;
                        gsap.to(aiToolsFeedbackResultEl, {opacity:1, y:0, duration:0.4, ease: 'power2.out'});
                    }});
                }
            });
        }

        // --- PDF экспорт раздела 2 ---
        const exportBtn = document.getElementById('exportSectionResultsBtn');
        if (!exportBtn) {
            // Добавить кнопку в футер, если её нет
            const footer = document.querySelector('footer .container.text-center .mt-4') || document.querySelector('footer .container.text-center');
            if (footer) {
                const btn = document.createElement('button');
                btn.className = 'btn btn-success';
                btn.id = 'exportSectionResultsBtn';
                btn.textContent = 'Выгрузить результаты раздела';
                footer.appendChild(btn);
            }
        }
        const exportBtn2 = document.getElementById('exportSectionResultsBtn');
        if (exportBtn2) {
            exportBtn2.addEventListener('click', function() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({unit: 'pt', format: 'a4'});
                if (window.QanelasRegularFontData && window.QanelasRegularFontData.base64) {
                    doc.addFileToVFS('Qanelas-Regular.ttf', window.QanelasRegularFontData.base64);
                    doc.addFont('Qanelas-Regular.ttf', 'Qanelas', 'normal');
                }
                doc.setFont('Qanelas', 'normal');
                const pageWidth = doc.internal.pageSize.getWidth();
                let y = 40;
                // Заголовок
                doc.setFontSize(22);
                doc.setTextColor('#198754');
                doc.text('Раздел 2: Внутренние коммуникации', pageWidth/2, y, {align:'center'});
                y += 30;
                doc.setFontSize(14);
                doc.setTextColor('#333');
                // Секции
                document.querySelectorAll('.content-section').forEach(section => {
                    const title = section.querySelector('h3')?.innerText || '';
                    if (title) {
                        doc.setFontSize(15);
                        doc.setTextColor('#20c997');
                        doc.text(title, 40, y);
                        y += 18;
                    }
                    doc.setFontSize(11);
                    doc.setTextColor('#444');
                    section.querySelectorAll('p, ul, ol').forEach(el => {
                        let text = '';
                        if (el.tagName === 'P') text = el.innerText;
                        if (el.tagName === 'UL' || el.tagName === 'OL') {
                            text = Array.from(el.children).map(li => '- ' + li.innerText).join('\n');
                        }
                        if (text) {




                            const split = doc.splitTextToSize(text, pageWidth-80);
                            doc.text(split, 40, y);
                            y += split.length * 15 + 5;
                        }
                    });
                    y += 10;
                });
                // AI feedback по инструментам (если есть)
                const aiToolsFeedback = document.getElementById('aiToolsFeedbackResult')?.innerText;
                if (aiToolsFeedback && aiToolsFeedback.trim() && aiToolsFeedback.trim() !== '🤖 ИИ анализирует ваши предложения...') {
                    doc.setFontSize(14);
                    doc.setTextColor('#20c997');
                    doc.text('AI-отзыв по вашим инструментам:', 40, y);
                    y += 18;
                    doc.setFontSize(11);
                    doc.setTextColor('#444');
                    const split = doc.splitTextToSize(aiToolsFeedback, pageWidth-80);
                    doc.text(split, 40, y);
                    y += split.length * 15 + 10;
                }
                doc.save('internal_communications_results.pdf');
            });
        }

        // === КАРУСЕЛЬ "Как коммуникации влияют на НКО?" теперь статична, без стрелок и прокрутки ===
(function() {
  const carousel = document.querySelector('.nko-carousel-container');
  if (!carousel) return;
  // Удаляем стрелки и пагинацию, если есть
  const arrows = carousel.querySelectorAll('.nko-carousel-arrow');
  arrows.forEach(el => el.remove());
  const pagination = carousel.querySelector('.nko-carousel-pagination');
  if (pagination) pagination.remove();
  // Убираем все js-управление, просто выравниваем карточки и цепочки
  let track = carousel.querySelector('.nko-carousel-track');
  if (!track) {
    track = document.createElement('div');
    track.className = 'nko-carousel-track';
    while (carousel.firstChild) track.appendChild(carousel.firstChild);
    carousel.appendChild(track);
  }
  const slides = Array.from(track.children).filter(el => el.classList.contains('nko-carousel-slide'));
  // Добавляем стрелки-цепочки между слайдами (если их нет)
  slides.forEach((slide, i) => {
    let arrow = slide.querySelector('.nko-chain-arrow');
    if (i < slides.length - 1 && !arrow) {
      arrow = document.createElement('div');
      arrow.className = 'nko-chain-arrow';
      arrow.innerHTML = '<svg width="36" height="24" viewBox="0 0 36 24"><path d="M2 12h32m0 0l-6-6m6 6l-6 6" stroke="#1bb86c" stroke-width="2" fill="none" stroke-linecap="round"/></svg>';
      slide.appendChild(arrow);
    }
    if (i === slides.length - 1 && arrow) arrow.remove();
  });
  // GSAP появление с ScrollTrigger
  gsap.fromTo(carousel, {opacity:0, y:40}, {
    opacity:1, y:0, duration:0.8, ease:'power2.out',
    scrollTrigger: {trigger:carousel, start:'top 80%', once:true}
  });
  slides.forEach((slide, i) => {
    gsap.fromTo(slide, {opacity:0, y:30}, {
      opacity:1, y:0, duration:0.7, delay:0.12*i,
      scrollTrigger: {trigger:carousel, start:'top 85%', once:true}
    });
  });
})();

// === АККОРДЕОН "Признаки здоровой оргкультуры" (мультиоткрытие) ===
(function() {
  const acc = document.querySelector('.culture-cards-accordion');
  if (!acc) return;
  const cards = Array.from(acc.querySelectorAll('.culture-card-accordion'));
  cards.forEach((card) => {
    const header = card.querySelector('.culture-card-header');
    const body = card.querySelector('.culture-card-body');
    header.style.cursor = 'pointer';
    header.addEventListener('click', () => {
      const isOpen = card.classList.contains('open');
      if (isOpen) {
        gsap.to(body, {height:0, opacity:0, duration:0.35, onComplete:()=>{
          card.classList.remove('open');
          body.style.display = 'none';
        }});
      } else {
        body.style.display = 'block';
        body.style.height = 'auto';
        const h = body.offsetHeight;
        body.style.height = '0px';
        gsap.to(body, {height:h, opacity:1, duration:0.4, ease:'power2.out', onStart:()=>{
          card.classList.add('open');
        }, onComplete:()=>{
          body.style.height = 'auto';
        }});
      }
    });
    // Изначально скрываем body
    body.style.display = 'none';
    body.style.height = '0px';
    body.style.opacity = 0;
  });
  // GSAP появление аккордеона
  gsap.fromTo(acc, {opacity:0, y:40}, {
    opacity:1, y:0, duration:0.8, ease:'power2.out',
    scrollTrigger: {trigger:acc, start:'top 85%', once:true}
  });
})();

        ScrollTrigger.refresh();
    });
    </script>
</body>
</html>
